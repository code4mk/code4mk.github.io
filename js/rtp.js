(function(a){var d="%",b={checkPattern:function(e,f){if(f.indexOf(d)==0&&f.lastIndexOf(d)==f.length-1){f=f.substring(1,f.length-1);return e.indexOf(f)!=-1}else{if(f.indexOf(d)==0){f=f.substring(1,f.length);return e.lastIndexOf(f)==e.length-f.length}else{if(f.lastIndexOf(d)==f.length-1){f=f.substring(0,f.length-1);return e.indexOf(f)==0}else{return e==f}}}},compareWithWildcard:function(n,e,f){var l;if(f===undefined||f==null){l=d}else{l=f}var j=e.split(l);if(!this.validateParam(j[j.length-1])){j.pop()}var m=e.indexOf(l)+1==e.length;var h=e.indexOf(l)==0;if(m&&j[j.length-1].lastIndexOf("/")+1==j[j.length-1].length){j[j.length-1]=j[j.length-1].substring(0,j[j.length-1].length-1)}for(var g=0;g<j.length;g++){if(g==0&&!h){if(n.indexOf(j[g])!=0){return false}}if(g+1==j.length&&!m){if(!(n.indexOf(j[g])+j[g].length==n.length)){return false}}var k=n.indexOf(j[g]);if(k==-1){return false}n=n.substring(k+j[g].length)}return true},validateParam:function(e){return(e!==undefined&&e!=null&&e!="null"&&e!="undefined"&&e!="")}},c={supports:function(){if(localStorage){return true}return false},store:function(e,f){localStorage[e]=f},getValue:function(e){return localStorage[e]},remove:function(e){localStorage.removeItem(e)}};a.ITLocalStorageAPI=c;a.InsighteraUtil=b})(window);(function(){if(window.AITag){return}var scriptExecutionTime=new Date().getTime(),msgCallTime=0,viewTime=0,isDebug=false;var performanceTime=window.performance&&window.performance.timing;function logMessage(message){if(isDebug&&window.console&&console.log){console.log("RTP message: "+message)}}function logMessageTime(message,currentTime,compareTo){if(!currentTime){currentTime=new Date().getTime()}if(compareTo){logMessage(message+(currentTime-compareTo))}else{if(performanceTime){logMessage(message+(currentTime-performanceTime.domLoading))}else{logMessage(message+(currentTime-scriptExecutionTime))}}}function isDefined(obj){return obj!==void 0&&obj!=null}function isObject(obj){return isDefined(obj)&&Object.prototype.toString.call(obj)=="[object Object]"}var tagScope="TAG",scriptScope="SCRIPT";var configScope={enableRecommendationBar:tagScope};var tagConfig={};function getTagConfig(){try{if(window.rtp){var config=rtp.e;if(isObject(config)){tagConfig=config}}}catch(e){logMessageTime("Error:: failed to get tag configurations")}}getTagConfig();var AITag=new function(){var cdnSrc=null;var config={"enableYoutubeApi":true,"googleAnalytics":true,"sCatSgmEvNum":21,"barIconFont":"fa-chevron","trackAsset":true,"sCatEnableCampaignPush":false,"uaEnableRecommendationPush":false,"uaSizeIndex":4,"enableTag":true,"jQueryUIDialogPath":"/jquery-ui-1.8.17-dialog.js","fbEnableABMPush":false,"dialogCloseButton":"/dialog-close.png","jQueryVersion":"1.8.3","sCatSgmIndNum":21,"uaEnableIndustryPush":true,"sCatCtaIndNum":23,"gaIndustrySlot":1,"background_color":"#1A95CE","jqueryUrl":"rtp-static.marketo.com/rtp/libs/jquery/VERSION/jquery.min.js","fbEnableCampaignPush":false,"youTubeApiUrl":"www.youtube.com/player_api","link_color":"white","arrowLeftPath":"/black_01.png","sCatEnableSegmentPush":false,"loadOnlyJQueryDialog":false,"startup":true,"enableSiteCatalyst":true,"captureLeads":true,"cdnSrcSSL":"https://rtp-static.marketo.com/rtp/libs","enableFBRemarketing":true,"jqueryUiCssExistsOnPage":false,"sCatIndVarNum":20,"viewBlocking":false,"timeoutDelay":3,"inZoneBlockingTimeout":0,"gaEnableCampaignPush":false,"fbEnableIndustryPush":false,"uaEnableSegmentPush":true,"uaEnableABMPush":true,"sCatEnableVisitorOrganization":false,"enableUAnalytics":true,"gaOrganizationSlot":2,"ignoreUrlParams":true,"requiredCssPath":"/insightera-1.3.css","font_color":"black","getAllEmails":true,"gwUrlPrefix":"sjrtp7.marketo.com/gw1","barIconColor":"#ffffff","userContextAPI":false,"pollingDelay":2,"sCatOrgVarNum":21,"campaignInjectionInterval":50,"sCatCtaEvNum":20,"cdnSrc":"http://rtp-static.marketo.com/rtp/libs","fbEnableGroupPush":false,"arrowRightPath":"/black_02.png","font_size":"17px","uaEnableRevenuePush":true,"pollingPerPage":1,"bar_position":"bottom","debug":false,"useExistingjQueryUI":false,"uaEnableCampaignPush":true,"jQueryUIVersion":"1.9.2","uaRevenueIndex":5,"font_family":"arial","useExistingJQuery":false,"gaEnableOrganizationtPush":false,"sCatEnableVisitorIndustry":false,"uaOrganizationIndex":2,"fbEnableCategoryPush":false,"uaEnableSizePush":true,"dialogCloseTime":30,"uaIndustryIndex":3,"disableClick":false,"gaEnableVisitorIndustry":false,"excludedUrlsRecommendation":"in [\"/enterprise\",\"/docker%\",\"/tutum\",\"/universal-control-plane\",\"/products%\",\"/pricing\"]","initialDelay":50,"bar_tab_position":"right","sCatCtaOrgNum":22,"requestInterval":50,"jqueryUIUrl":"rtp-static.marketo.com/rtp/libs/jqueryui/VERSION/jquery-custom-ui.min.js","jQueryUICustomCssPath":"/jquery-ui-insightera-custom-1.8.css","barIconOpacity":0.4,"uaEnableOrganizationPush":true,"enableRecommendationBar":false,"sCatSgmOrgNum":20,"disablePoll":false,"loadJquery":true,"fbEnableSegmentedAudiencePush":false,"uaABMIndex":6,"gaEnableSegmentPush":false};var campaignUrlData="";var currentPageAllowedZones=[],currentPageAllowedCampaigns=[],allPagesAllowedCampaigs=[],potentialCampaignExist=false;var sessionReady=false,sessionQueue=[];var exp_2_year=new Date();var exp_30_minutes=new Date();exp_2_year.setTime(exp_2_year.getTime()+(730*24*60*60*1000));exp_30_minutes.setTime(exp_30_minutes.getTime()+(30*60*1000));var sessionId=null;var sessionExpireId=null;var isDialogPresented=false;var second=1000;var newVisitor=false;var newSession=false;var viewedZones=[];var viewedTypes=[];var COOKIE_TRW_SESSION_ID="trwsa.sid";var COOKIE_TRW_SEARCH_TERMS="trwsb.stu";var COOKIE_TRW_CLICK_PER_VISIT="trwsb.cpv";var COOKIE_TRW_CREATION_DATE="trwv.crd";var COOKIE_TRW_COUNT="trwv.vc";var COOKIE_TRW_LAST_VISIT="trwv.lvd";var COOKIE_TRW_EMAIL="trwv.eml";var COOKIE_TRW_VISITOR_UID="trwv.uid";var COOKIE_TRW_IE_EMAIL="_ie_eml";var COOKIE_TRW_IE_CPN="_ie_cpn";var COOKIE_TRW_SESSION_ID_EXPIRE="trwsb.sid";var COOKIE_TRW_CURRENT_VISIT="trwv.cvd";var ESP_COOKIES_ARR=[COOKIE_TRW_SESSION_ID,COOKIE_TRW_EMAIL,COOKIE_TRW_VISITOR_UID];var unusedCookies=[COOKIE_TRW_SEARCH_TERMS,COOKIE_TRW_CLICK_PER_VISIT,COOKIE_TRW_CREATION_DATE,COOKIE_TRW_COUNT,COOKIE_TRW_LAST_VISIT,COOKIE_TRW_IE_EMAIL,COOKIE_TRW_IE_CPN,COOKIE_TRW_CURRENT_VISIT,COOKIE_TRW_SESSION_ID_EXPIRE];var COOKIE_TRW_LOG="trw1.LOG";var COOKIE_MARKETO_TOKEN="_mkto_trk";var SESSION_ID_CLICKS_SEPERATOR="$$$###";var COOKIE_VAL_SEPERATOR=":";var IMPRESSION_SUFFIX=":0";var CONVERSION_SUFFIX=":1";var MA_TYPE_MARKETO="1";var MA_TYPE_NONE="0";var VISITOR_UUID="REPLACE_VUUID";var SESSION_UUID="REPLACE_SUUID";var VISITOR_IP="REPLACE_IP";var POSITION_TOP="50";var widgetSide="";var PDF=".pdf";var PPT=".ppt";var PPTX=".pptx";var HTML5_VIDEO_MP4=".mp4";var HTML5_VIDEO_OGG=".ogg";var HTML5_VIDEO_WEBM=".webm";var RTP_PARAM_INDICATION="iesrc",RCMD_PARAM_VALUE="rcmd",ASSET_ID_PARAM="astid",ASSET_TYPE_PARAM="at";var ASSETS_SUFFIX_ARR=[PDF,PPT,PPTX,HTML5_VIDEO_MP4,HTML5_VIDEO_OGG,HTML5_VIDEO_WEBM];var videoIframeMap={};var videoAPILoaded={};var TARGET_VAL=["_self","_parent","_top"];var PLAYERS=["youtube","wistia","vimeo"];var WISTIA_API_SRC="fast.wistia.net/static/iframe-api-v1.js";var VIMEO_API_SRC="/froogaloop2.min.js";var playersData={players:{},playerIds:[],lastCount:0};var VIMEO_PLAYER_ID="player_id";var EMAIL_REG=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;var BAR_CDN_PATH="/insightera-bar-2.1.js";var GA_CDN_PATH="/ga-integration-2.0.1.js";var fontsCss="netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css";var domainLevel=null;var localStorageApi=ITLocalStorageAPI;window.iiq=window.iiq||[];window.ibq=window.ibq||[];var cpq=[];var rcmdq=[];var campaignLinks={};var assetLinks={};var nonjQueryCampaignQueue=[];var mktoExistOnClick=false;var eventFirstClick=false;var isReady=false;var previewMode=false;var getInternetExplorerVersion=function(){var rv=-1;if(navigator.appName=="Microsoft Internet Explorer"){var ua=navigator.userAgent;var re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!=null){rv=parseFloat(RegExp.$1)}}else{if(navigator.appName=="Netscape"){var ua=navigator.userAgent;var re=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!=null){rv=parseFloat(RegExp.$1)}}}return rv};var checkIESupported=function(){var version=getInternetExplorerVersion();if(version>-1&&version<8){return false}else{if(version>7){if(document.documentMode&&document.documentMode<8){return false}}}return true};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(obj){for(var i=0;i<this.length;i++){if(this[i]==obj){return i}}return -1}}var campaignStorage=new function(){var STORAGENAME="it.cs",DIALOG="dialog",WIDGET="widget",SESSION_ID="sid",_this=this;trackObj=null,isCurrentSession=function(campaigns){if(campaigns[SESSION_ID]!==getSessionId()){return false}return true};this.init=function(){trackObj=window.AITag||null};this.getStoredCampaigns=function(){var campaigns=null;if(localStorageApi.supports()){campaigns=localStorageApi.getValue(STORAGENAME);if(campaigns!==undefined&&campaigns!=null){campaigns=JSON.parse(campaigns)}}return campaigns};this.showStoredCampaigns=function(){if(localStorageApi.supports()){var campaigns=_this.getStoredCampaigns();if(campaigns!==undefined&&campaigns!=null&&isCurrentSession(campaigns)){for(var campaign in campaigns){if(campaigns.hasOwnProperty(campaign)&&campaign!=SESSION_ID){try{trackObj.msgCallback(campaigns[campaign][0],campaigns[campaign][1],false,true)}catch(e){logMessage("failed to show stored campaign. error: "+e.message)}}}}else{localStorageApi.remove(STORAGENAME)}}};this.storeCampaign=function(campaignMsg,requestId){if(localStorageApi.supports()){var campaigns=this.getStoredCampaigns();if(campaigns===undefined||campaigns==null){campaigns={}}else{if(!isCurrentSession(campaigns)){campaigns={}}}campaigns[SESSION_ID]=getSessionId();if(campaignMsg.targetDiv){campaigns[campaignMsg.targetDiv]=[campaignMsg,requestId]}else{campaigns[DIALOG]=[campaignMsg,requestId]}localStorageApi.store(STORAGENAME,JSON.stringify(campaigns))}};this.exc=function(params){try{var method=params.shift();_this[method].apply(_this,params)}catch(e){console.log(e)}}};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}function consoleMessage(message){if(console&&console.log){console.log(message)}}function createCORSRequest(method,url){var xhr=new XMLHttpRequest();if("withCredentials" in xhr){try{xhr.open(method,url,true)}catch(e){consoleMessage(e)}}else{if(typeof XDomainRequest!="undefined"){xhr=new XDomainRequest();xhr.open(method,url)}else{xhr=null}}return xhr}function makeCorsRequest(url,handler){if(url===undefined||url==null||url==""){return}if(url.indexOf("http")!=0&&url.indexOf("https")!=0){url=AITag.getConfig("protocol")+"://"+url}var xhr=createCORSRequest("GET",url);if(!xhr){consoleMessage("CORS not supported");return}xhr.onload=function(){var text=xhr.responseText;var response=JSON.parse(text);if(response.status==200){if(typeof handler=="function"){handler(response)}}else{consoleMessage(response.errorMessage)}};xhr.onerror=function(){};xhr.send()}this.activateRecommendation=function(){if(this.getConfig("enableRecommendationBar")){var expression=this.getConfig("excludedUrlsRecommendation");var match=true;var condition="";if(expression!==undefined){var url=window.location.pathname;condition=expression.substring(0,expression.indexOf("[")-1).trim();var excludeUrls=expression.substring(expression.indexOf("["));excludeUrls=eval(excludeUrls);for(var index=0;index<excludeUrls.length;index++){match=InsighteraUtil.checkPattern(url,excludeUrls[index]);if(condition=="in"&&match){break}if(match){this.setConfig("enableRecommendationBar",false);return}}}if(condition=="in"&&!match){this.setConfig("enableRecommendationBar",false);return}this.addDynamicScript(cdnSrc+BAR_CDN_PATH,function(){});logMessageTime("loaded recommendation Bar. Time since DOM loading: ",new Date().getTime())}};this.eventCallback=function(response){};this.updateInitialConfig=function(){if(!window.AIConfig){window.AIConfig={}}campaignStorage.init();this.setDefaultConfig("protocol",(("https:"==document.location.protocol)?"https":"http"));cdnSrc=(AITag.getConfig("protocol")=="http")?this.getConfig("cdnSrc"):this.getConfig("cdnSrcSSL");var jQueryUrl=this.getConfig("jqueryUrl");jQueryUrl=jQueryUrl.replace("VERSION",this.getConfig("jQueryVersion"));var jQueryUIUrl=this.getConfig("jqueryUIUrl");jQueryUIUrl=jQueryUIUrl.replace("VERSION",this.getConfig("jQueryUIVersion"));this.setConfig("jqueryUrl",jQueryUrl);this.setConfig("jqueryUIUrl",jQueryUIUrl);this.setConfig("moderntrim2CloseButton","/modern-trim-II-close.png");this.setConfig("dialogTransparentButton","/trans_x.png");this.pollIntervalCounter=0;var mktoTrk=this.getCookie(COOKIE_MARKETO_TOKEN);if(mktoTrk!=null){this.setDefaultConfig("ma",MA_TYPE_MARKETO)}else{this.setDefaultConfig("ma",MA_TYPE_NONE)}addDOMReadyListener(runAsyncQueue);if(window.rtp){this.setConfig("pollingPerPage",2)}if(isAnalyticsEnabled()){try{iiq.push(["setGWPrefix",AITag.getConfig("gwUrlPrefix")]);iiq.push(["updateConfig",{eGaIndrPush:AITag.getConfig("gaEnableVisitorIndustry"),eGaOrgPush:AITag.getConfig("gaEnableOrganizationtPush"),eGaSgmPush:AITag.getConfig("gaEnableSegmentPush"),eGaCmpPush:AITag.getConfig("gaEnableCampaignPush"),eSIndrPush:AITag.getConfig("sCatEnableVisitorIndustry"),eSOrgPush:AITag.getConfig("sCatEnableVisitorOrganization"),eSSgmPush:AITag.getConfig("sCatEnableSegmentPush"),eSCtaPush:AITag.getConfig("sCatEnableCampaignPush"),gaIndrSlot:AITag.getConfig("gaIndustrySlot"),gaOrgSlot:AITag.getConfig("gaOrganizationSlot"),sIndCC:AITag.getConfig("sCatIndVarNum"),sOrgCC:AITag.getConfig("sCatOrgVarNum"),sSgmCE:AITag.getConfig("sCatSgmEvNum"),sCmpCE:AITag.getConfig("sCatCtaEvNum"),eGA:AITag.getConfig("googleAnalytics"),eSC:AITag.getConfig("enableSiteCatalyst"),sSgmOrgTV:AITag.getConfig("sCatSgmOrgNum"),sSgmIndTV:AITag.getConfig("sCatSgmIndNum"),sCmpOrgTV:AITag.getConfig("sCatCtaOrgNum"),sCmpIndTV:AITag.getConfig("sCatCtaIndNum"),gaOrgIndex:AITag.getConfig("ugaOrgIndex"),gaIndrIndex:AITag.getConfig("ugaIndrIndex"),gaSgmIndex:AITag.getConfig("ugaSgmIndex"),eUA:AITag.getConfig("enableUAnalytics"),eUAOrgPush:AITag.getConfig("uaEnableOrganizationPush"),eUAIndrPush:AITag.getConfig("uaEnableIndustryPush"),eUASizePush:AITag.getConfig("uaEnableSizePush"),eUARevenuePush:AITag.getConfig("uaEnableRevenuePush"),eUAaBMPush:AITag.getConfig("uaEnableABMPush"),eUASgmPush:AITag.getConfig("uaEnableSegmentPush"),eUACtaPush:AITag.getConfig("uaEnableCampaignPush"),eUARcmdPush:AITag.getConfig("uaEnableRecommendationPush"),uaOrgIndex:AITag.getConfig("uaOrganizationIndex"),uaIndrIndex:AITag.getConfig("uaIndustryIndex"),uaSizeIndex:AITag.getConfig("uaSizeIndex"),uaRevenueIndex:AITag.getConfig("uaRevenueIndex"),uaABMIndex:AITag.getConfig("uaABMIndex"),eFC:AITag.getConfig("enableFBRemarketing"),eFCIndPush:AITag.getConfig("fbEnableIndustryPush"),eFCCatPush:AITag.getConfig("fbEnableCategoryPush"),eFCGroupPush:AITag.getConfig("fbEnableGroupPush"),eFCAbmPush:AITag.getConfig("fbEnableABMPush"),eFCSAPush:AITag.getConfig("fbEnableSegmentedAudiencePush"),eFCCmpPush:AITag.getConfig("fbEnableCampaignPush"),newV:AITag.isNewVisitor(),newS:AITag.isNewSession(),aid:AITag.getConfig("accountId")}])}catch(e){logMessage("Error happened while initialize Integration . Error "+e)}}};var getDomain=function(domain,domainLevel){if(domainLevel!=null&&domainLevel===parseInt(domainLevel)){for(var splitedDomain=domain.split(".");splitedDomain.length>domainLevel&&splitedDomain.length>2;){splitedDomain.shift()}return splitedDomain.join(".")}splitedDomain=/([^.]+\.[^.]{3,})$/i.exec(domain);return splitedDomain!=null?splitedDomain[1]:(splitedDomain=/([^.]+\.[^.]+\.[^.]{2})$/i.exec(domain),splitedDomain!=null?splitedDomain[1]:domain)};this.extractURLParameter=function(name){return extractParam(location.search,name)};function extractParam(url,name){return decodeURIComponent((new RegExp("[?|&]"+name+"=([^&;]+?)(&|#|;|$)").exec(url)||[,""])[1].replace(/\+/g,"%20"))||null}var SCHEME="://",WWW="www.",WILDCARD="*",WILDCARD_REGEX=/\*/g,ALLOWED_WILDCARD="%",URL_WITHOUT_QUERY="url",URL_WITH_QUERY="urlWithQuery";function containsWildcard(url){return url.indexOf(WILDCARD)>-1}function getCurrentUrlAsArray(){var location=window.location;var currentURL=normalizeURLPrefix(location.host)+location.pathname;var urlArray=[];urlArray[URL_WITH_QUERY]=(InsighteraUtil.validateParam(location.search)||InsighteraUtil.validateParam(location.hash))?currentURL+location.search+location.hash:normalizeURLSuffix(currentURL);urlArray[URL_WITH_QUERY]=decodeURI(urlArray[URL_WITH_QUERY]);urlArray[URL_WITHOUT_QUERY]=(InsighteraUtil.validateParam(location.hash))?currentURL+location.hash:normalizeURLSuffix(currentURL);urlArray[URL_WITHOUT_QUERY]=decodeURI(urlArray[URL_WITHOUT_QUERY]);return urlArray}function normalizeURLPrefix(url){var idx=url.indexOf(SCHEME);if(idx>-1&&idx<6){url=url.substring(idx+SCHEME.length)}idx=url.indexOf(WWW);if(idx==0){url=url.substring(WWW.length)}return url}function normalizeURLSuffix(url,includeQuery){if(includeQuery!==undefined&&(includeQuery=="false"||includeQuery===false)){var idx=url.indexOf("?"),hashIdx=url.indexOf("#");var hashString="";if(idx>0){if(hashIdx>-1){hashString=url.substring(hashIdx)}url=url.substring(0,idx);url+=hashString}}idx=url.lastIndexOf("/");if(idx+1==url.length){url=url.substring(0,url.length-1)}return url}function normalizeURL(url,includeQuery){url=normalizeURLPrefix(url);url=normalizeURLSuffix(url,includeQuery);return url}function matchUrls(urlFilters,includeUrlQuery){if(urlFilters===undefined||urlFilters==null||urlFilters.length==0){return true}var currentUrl=getCurrentUrlAsArray(),url;for(var i=0;i<urlFilters.length;i++){if(isURLMatch(currentUrl,urlFilters[i],includeUrlQuery)){return true}}return false}function isURLMatch(currentUrl,url,includeQuery){url=normalizeURL(url,includeQuery);url=decodeURI(url);url=url.replace(WILDCARD_REGEX,ALLOWED_WILDCARD);return includeQuery=="true"||includeQuery===true?InsighteraUtil.compareWithWildcard(currentUrl[URL_WITH_QUERY],url):InsighteraUtil.compareWithWildcard(currentUrl[URL_WITHOUT_QUERY],url)}function concatArray(first,second,notAllowed){for(var i=0;i<second.length;i++){if(InsighteraUtil.validateParam(second[i])&&notAllowed===undefined||notAllowed.indexOf(second[i])==-1){first.push(second[i])}}return first}this.checkExcludeUrls=function(){var excludeUrls=this.getConfig("excludeUrls");if(excludeUrls!==undefined){var ignoreUrlParams=this.getConfig("ignoreUrlParams");if(typeof ignoreUrlParams=="undefined"){ignoreUrlParams=true}var url=window.location.pathname;if(!ignoreUrlParams){url+=window.location.search}for(var index=0;index<excludeUrls.length;index++){if(InsighteraUtil.checkPattern(url,excludeUrls[index])){return true}}}return false};this.hex2rgb=function(hex,opacity){var rgb=hex.replace("#","").match(/(.{2})/g);var i=3;while(i--){rgb[i]=parseInt(rgb[i],16)}if(typeof opacity=="undefined"){return"rgb("+rgb.join(", ")+")"}return"rgba("+rgb.join(", ")+", "+opacity+")"};this.rgb2hex=function(rgb){var hex;var hexString="",hexWord="";var i=0;if(rgb.indexOf("rgba")==-1){hex=rgb.replace("rgb(","");hex=hex.replace(")","").replace(" ","").split(",")}else{hex=rgb.replace("rgba(","").replace(")","").replace(" ","").split(",")}if(hex.length==3){hexString+="#ff"}else{hexString+="#"+Math.floor(hex[3]*255).toString(16)}while(i<3){hexWord=(hex[i]*1).toString(16);hexWord=hexWord.length==1?"0"+hexWord:hexWord;hexString+=hexWord;i++}return hexString};this.addEvent=function(evnt,elem,func){if(elem.addEventListener){elem.addEventListener(evnt,func,true)}else{if(elem.attachEvent){elem.attachEvent("on"+evnt,func)}else{elem[evnt]=func}}};function injectScript(elementTagName,location,scriptContent){var script=document.createElement("script");script.type="text/javascript";try{script.innerHTML=scriptContent}catch(e){script.text=scriptContent}var element=document.getElementsByTagName(elementTagName);if(element&&element.length>0){element=element[0];switch(location){case"FIRST":element.insertBefore(script,head.firstChild);break;case"LAST":element.appendChild(script);break;default:break}}}this.addScriptInHeader=function(scriptContent){var script=document.createElement("script");script.type="text/javascript";try{script.innerHTML=scriptContent}catch(e){script.text=scriptContent}var head=document.getElementsByTagName("head")[0];head.insertBefore(script,head.firstChild)};this.onPlayerStateChange=function(e){try{e=e||window.event;var targetElement=e.target||e.srcElement;var videoData=targetElement.getVideoData();if(videoData){var player=playersData.players.youtube[videoData.video_id];if(e.data==1&&typeof player.sendVideoAsset=="undefined"){AITag.sendClick(targetElement.getVideoUrl(),null,{yt:1});playersData.players.youtube[videoData.video_id].sendVideoAsset=1}}}catch(e){}};var rcmdClickObjName="rtpRH",visitorIdProp="vi",rcmdHistoryProp="rcmdH",expRcmd=1000*60*60*24*90,storeRcmdClick="storeClick",cleanRCMDHistory="cleanHistory",getAsParams="getAsParams",extractAssetId="extractAssetId",getLastRCMD="getLastRCMD";var RCMDStorage={};RCMDStorage[cleanRCMDHistory]=function(rcmdHistory,currentTime,newAssetId){var existIndex=null;var indexsToRemove=[];for(var i=0;i<rcmdHistory.length;i++){for(var assetId in rcmdHistory[i]){if(rcmdHistory[i].hasOwnProperty(assetId)){if((rcmdHistory[i][assetId]+expRcmd)<currentTime){indexsToRemove.push(i)}else{if(newAssetId&&assetId==newAssetId){indexsToRemove.push(i)}}}}}if(indexsToRemove.length>0){for(var j=0;j<indexsToRemove.length;j++){rcmdHistory.splice(indexsToRemove[j]-j,1)}}if(rcmdHistory.length==5){rcmdHistory.splice(0,1)}return rcmdHistory};RCMDStorage[getLastRCMD]=function(rcmdHistory,currentTime){var lastRCMD=null,lastTime=null;for(var i=0;i<rcmdHistory.length;i++){for(var assetId in rcmdHistory[i]){if(rcmdHistory[i].hasOwnProperty(assetId)){if((rcmdHistory[i][assetId]+expRcmd)>currentTime){if(lastRCMD==null||lastTime<rcmdHistory[i][assetId]){lastRCMD=assetId;lastTime=rcmdHistory[i][assetId]}}}}}return lastRCMD};RCMDStorage[storeRcmdClick]=function(assetId){var visitorId=getVisitorId();var currentTime=new Date().getTime();if(visitorId!=null){var currentData=localStorageApi.getValue(rcmdClickObjName);if(currentData!==void 0){currentData=JSON.parse(currentData);if(currentData[visitorIdProp]&&currentData[visitorIdProp]==visitorId){var rcmdHistory=currentData[rcmdHistoryProp];if(rcmdHistory===void 0||rcmdHistory==null){rcmdHistory=[]}else{rcmdHistory=this[cleanRCMDHistory](rcmdHistory,currentTime,assetId)}}else{currentData={};rcmdHistory=[]}}else{currentData={};rcmdHistory=[]}var newRcmdClick={};newRcmdClick[assetId]=currentTime;rcmdHistory.push(newRcmdClick);currentData[visitorIdProp]=visitorId;currentData[rcmdHistoryProp]=rcmdHistory;localStorageApi.store(rcmdClickObjName,JSON.stringify(currentData))}};RCMDStorage[getAsParams]=function(){var params=null;var visitorId=getVisitorId();var currentData=localStorageApi.getValue(rcmdClickObjName);if(currentData!==void 0){currentData=JSON.parse(currentData);var currentTime=new Date().getTime();if(currentData[visitorIdProp]&&currentData[visitorIdProp]==visitorId){rcmdHistory=this[cleanRCMDHistory](currentData[rcmdHistoryProp],currentTime,null);var rcmdIds=[];for(var i=0;i<rcmdHistory.length;i++){for(var assetId in rcmdHistory[i]){if(rcmdHistory[i].hasOwnProperty(assetId)){rcmdIds.push(assetId)}}}if(rcmdIds.length>0){params={};params.rch=rcmdIds.join();var lastRCMD=this[getLastRCMD](rcmdHistory,currentTime);if(lastRCMD!=null){params.lcrc=lastRCMD}}}}return params};RCMDStorage[extractAssetId]=function(url){return extractParam(url,ASSET_ID_PARAM)};var discoverRecommendation=function(href){var paramsIndex=href.indexOf("?");if(paramsIndex!=-1){var parameters=href.substring(paramsIndex);if(parameters.indexOf("iesrc=rcmd")!=-1){try{var assetId=RCMDStorage[extractAssetId](parameters);if(assetId){RCMDStorage[storeRcmdClick].call(RCMDStorage,assetId)}}catch(e){}AITag.sendClick(encodeURIComponent(href),null,{cmd:3,asid:assetId},true)}}};function isRecommendation(href){var paramsIndex=href.indexOf("?");if(paramsIndex!=-1){var parameters=href.substring(paramsIndex);if(parameters.indexOf("iesrc=rcmd")!=-1){return true}}return false}var getPalyerId=function(iframe,count){var iframeId;if(typeof iframe.id!="undefined"&&iframe.id!=null&&iframe.id!=""){iframeId=iframe.id}else{iframe.id="player"+count;iframeId="player"+count}return iframeId};this.addPlayer=function(type,player,id,src){players=playersData.players[type];if(players===undefined){players={}}var iplayer={};iplayer.player=player;iplayer.src=src;players[id]=iplayer;playersData.players[type]=players};function handleVimeoPlayers(){var players=playersData.players.vimeo;for(var id in players){(function(player,src){if(player.element.contentWindow!=null){player.addEvent("play",function(player,src){return function(){AITag.sendClick(src,null,{yt:1});player.removeEvent("play")}}(player,src))}})(players[id].player,players[id].src)}}var createVimeoEventListener=function(iframe,type){(function(iframe,type,src){var player=$f(iframe);AITag.addPlayer(type,player,iframe.id,src);try{handleVimeoPlayers()}catch(e){}player.addEvent("ready",function(){handleVimeoPlayers()})})(iframe,type,iframe.src)};var bindPlayerEvent=function(type,iframe,count,src){iframeId=getPalyerId(iframe,count);var players;switch(type){case"youtube":try{var url=src;var queryStringIndex=url.indexOf("?");if(queryStringIndex>-1){url=url.substring(0,queryStringIndex)}var videoIdIndex=url.lastIndexOf("/");var videoId=url.substring(videoIdIndex+1);(function(type,iframeId,videoId){if(src.indexOf("?")!=-1&&src.indexOf("enablejsapi=1")==-1){iframe.contentWindow.location.replace(iframe.src+"&enablejsapi=1")}else{if(src.indexOf("api=1")==-1){iframe.contentWindow.location.replace(iframe.src+"?enablejsapi=1")}}var player=iframe.contentWindow;var host=extractHost(url);createYoutubeEventListener(player,host,iframeId);AITag.addPlayer(type,player,videoId,src)})(type,iframeId,videoId)}catch(e){}break;case"wistia":(function(type,iframeId,src){var wistiaEmbed=document.getElementById(iframeId).wistiaApi;if(wistiaEmbed){wistiaEmbed.bind("play",function(src){return function(){AITag.sendClick(src,null,{yt:1});return this.unbind}}(src))}AITag.addPlayer(type,wistiaEmbed,iframeId)})(type,iframeId,src);break;case"vimeo":if(window.$f!==undefined){var iframeSrc=iframe.src;if(iframeSrc.indexOf("api=1")==-1){iframeSrc=addParams2URI(iframeSrc,{api:1})}if(iframeSrc.indexOf(VIMEO_PLAYER_ID)==-1){iframeSrc=addParams2URI(iframeSrc,{player_id:iframeId})}iframe.contentWindow.location.replace(iframeSrc);createVimeoEventListener(iframe,type)}break}playersData.playerIds.push(src);count++;playersData.lastCount=count;return count};function extractHost(url,defaultProtocol){var host;var originalUrl=url;if(url.indexOf("://")==-1){if(typeof defaultProtocol!="undefined"){url=defaultProtocol+"://"+url}else{url="https://"+url}}var el=document.createElement("a");el.href=url;if(el.protocol!=undefined&&el.protocol.trim()!=""){if(el.host.indexOf("youtube")>-1&&el.protocol=="http:"){host="https://"+el.host}else{host=el.protocol+"//"+el.host}}else{host=originalUrl}return host}function createYoutubeEventListener(player,host,iframeId){var addListener=typeof YT!="undefined"&&YT.get&&YT.get(iframeId)!==undefined;addMessageEvent(player,host,!addListener)}var addMessageEvent=function(player,host,addListener){var interval=null;AITag.addEvent("message",window,function(event){if(event.source==player){if(interval){interval=clearInterval(interval)}var json=JSON.parse(event.data);if(json.info!=null&&typeof(json.info.playerState)!="undefined"){var ytPlayer=playersData.players.youtube[json.info.videoData.video_id];if(json.info.playerState==1&&typeof ytPlayer.sendVideoAsset=="undefined"){AITag.sendClick(ytPlayer.src,null,{yt:1});ytPlayer.sendVideoAsset=1}}}});if(addListener){var firstCall=null;interval=setInterval(function(){if(!firstCall){firstCall=(new Date()).getTime()}if((new Date()).getTime()-firstCall>2000){interval=clearInterval(interval)}player.postMessage('{"event":"listening","id":"apiID"}',host)},250)}};function addVideoIframe(type,iframe,iframeMap,fancyboxLoad){var iframeArray=videoIframeMap[type];var currentVideoArray=iframeMap[type],valid=true;if(iframeArray===undefined||iframeArray==null){iframeArray=[];addPlayersApis(type)}if(currentVideoArray===void 0||currentVideoArray==null){currentVideoArray=[]}for(var i=0;i<iframeArray.length;i++){if(iframeArray[i].id===iframe.id&&iframeArray[i].src==iframe.src){valid=false}}if(valid){if(!fancyboxLoad){iframeArray.push(iframe);videoIframeMap[type]=iframeArray}currentVideoArray.push(iframe);iframeMap[type]=currentVideoArray}return iframeMap}var getPlayersIframes=function(fancyboxLoad){var iframes=document.getElementsByTagName("iframe");var iframeMap={},src;for(var i=0;i<iframes.length;i++){src=iframes[i].src;if(src.indexOf("youtube")!=-1){iframeMap=addVideoIframe("youtube",iframes[i],iframeMap,fancyboxLoad)}else{if(src.indexOf("wistia")!=-1){iframeMap=addVideoIframe("wistia",iframes[i],iframeMap,fancyboxLoad)}else{if(src.indexOf("player.vimeo.com")!=-1){iframeMap=addVideoIframe("vimeo",iframes[i],iframeMap,fancyboxLoad)}}}}setTimeout(function(){addPlayersListerners(iframeMap)},1000)};var addPlayersListerners=function(iframeMap){var iframesArr,count=0;for(var i=0;i<PLAYERS.length;i++){iframesArr=iframeMap[PLAYERS[i]];if(iframesArr!==undefined&&iframesArr!=null&&iframesArr.length>0){for(var j=0;j<iframesArr.length;j++){src=iframesArr[j].src;if(src.indexOf("youtube")!=-1){count=bindPlayerEvent("youtube",iframesArr[j],count,src)}else{if(src.indexOf("wistia")!=-1){count=bindPlayerEvent("wistia",iframesArr[j],count,src)}else{if(src.indexOf("player.vimeo.com")!=-1){count=bindPlayerEvent("vimeo",iframesArr[j],count,src)}}}}}}};var addPlayersApis=function(type){if(videoAPILoaded[type]!==void 0&&videoAPILoaded[type]==1){return}videoAPILoaded[type]=1;switch(type){case"youtube":break;case"vimeo":AITag.addDynamicScript(cdnSrc+VIMEO_API_SRC);break;case"wistia":AITag.addDynamicScript(WISTIA_API_SRC,null,true);break;default:throw"cannot import unknown type: "+type}};var createEvent=function(eventName,target){var event;if(document.createEvent){event=document.createEvent("MouseEvents");event.initMouseEvent(eventName,target.bubbles,target.cancelable,target.view,target.detail,target.screenX,target.screenY,target.clientX,target.clientY,target.ctrlKey,target.altKey,target.shiftKey,target.metaKey,target.button,target.relatedTarget)}else{if(document.createEventObject){event=document.createEventObject();event.eventType=eventName}}event.eventName=eventName;return event};var dispatchEvent=function(el,event){var eventName=event.eventName;if(el.dispatchEvent){el.dispatchEvent(event)}else{if(el.fireEvent&&window.htmlEvents&&window.htmlEvents["on"+eventName]){el.fireEvent("on"+event.eventType,event)}else{window.open(el.href,(typeof el.target=="undefined"||el.target==null||el.target=="")?"_self":el.target)}}};var addEventReport=function(target,e){return function(){if(e.assetClicked===undefined){e.assetClicked=true;dispatchEvent(target,e)}}};var checkIfAssetLink=function(targetElement,e){var href=targetElement.href;if(assetLinks[href]&&assetLinks[href]==1){return}if(isRecommendation(href)){discoverRecommendation(href)}var path=targetElement.pathname;var target=targetElement.target;if(typeof target=="undefined"||target==null||target==""){target="_self"}if(typeof href!="undefined"&&href!=null&&typeof path!="undefined"&&path!=null){for(var i=0;i<ASSETS_SUFFIX_ARR.length;i++){var lastIndex=path.lastIndexOf(ASSETS_SUFFIX_ARR[i]);if(lastIndex!=-1&&(lastIndex+ASSETS_SUFFIX_ARR[i].length)==path.length){var assetlink=campaignLinks[href];if(TARGET_VAL.indexOf(target)!=-1&&!assetlink){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}assetLinks[href]=1;var event=createEvent("click",e);event=addEventReport(targetElement,event);AITag.setConfig("disableClick",false);AITag.sendClick(encodeURIComponent(href),function(){if(TARGET_VAL.indexOf(target)!=-1&&!campaignLinks[href]){AITag.setConfig("disableClick",true);event()}});return}}for(var i=0;i<PLAYERS.length;i++){if(href.indexOf(PLAYERS[i])!=-1){setTimeout(function(){getPlayersIframes(true)},800);break}}}};this.addAssetCollector=function(){if(this.getConfig("trackAsset")){AITag.addEvent("click",document,function(e){if((AITag.lastEvent&&(new Date).getTime()-AITag.lastEvent<100)||e.assetClicked||e._mchInRepost){return true}AITag.lastEvent=(new Date).getTime();e=e||window.event;var targetElement=e.target||e.srcElement;var parent=AITag.jQuery(targetElement).parents("a");if(targetElement.tagName=="A"){checkIfAssetLink(targetElement,e)}else{if(parent.get(0)){var parentEl=parent.get(0);if(parentEl.tagName=="A"){checkIfAssetLink(parentEl,e)}}}if(targetElement.tagName=="VIDEO"){AITag.sendAssetClick(function(){var src="";src=targetElement.src;if(src==null||src==""){var children=targetElement.children;for(var i=0;i<children.length;i++){src=children[i].src;if(typeof src!="undefined"&&src!=""){break}}}AITag.sendClick(src)})}});try{getPlayersIframes()}catch(e){console.log(e)}}};this.sendAssetClick=function(func){func.apply(AITag)};this.setConfig=function(key,val){config[key]=val};this.setDefaultConfig=function(key,val){if(typeof config[key]==="undefined"){this.setConfig(key,val)}};this.escapePercent=function(text){return encodeURIComponent(text)};this.getConfig=function(key){var value=null;var scope=configScope[key];value=tagConfig[key];if(scope==tagScope&&isDefined(value)){return value}if(typeof config!="undefined"){value=config[key]}if(typeof value=="undefined"||value==null){value=window.AIConfig[key]}return value};var getCookieDataArray=function(cookieName){var val=AITag.getCookie(cookieName);if(val!=null){val=val.split(COOKIE_VAL_SEPERATOR)}return val},getVisitorId=function(){var visitorId=null;var visitorArr=getCookieDataArray(COOKIE_TRW_VISITOR_UID);if(visitorArr!=null&&visitorArr.length>0){visitorId=visitorArr[0]}return visitorId},getVisitorIdParam=function(){var visitorId=getVisitorId();if(visitorId!=null){return COOKIE_TRW_VISITOR_UID+"="+visitorId}return""},getVisitCount=function(){var vc=null;var visitorArr=getCookieDataArray(COOKIE_TRW_VISITOR_UID);if(visitorArr!=null&&visitorArr.length>1){vc=parseInt(visitorArr[1],10);if(isNaN(vc)||vc<1){return null}}return vc},getVCParam=function(){var vc=getVisitCount();if(vc!=null){return COOKIE_TRW_COUNT+"="+vc}return""},getKnown=function(){var visitorArr=getCookieDataArray(COOKIE_TRW_VISITOR_UID);if(visitorArr!=null&&visitorArr.length>2){if(parseInt(visitorArr[2])==1){return 1}}return 0},getKnownParam=function(){var known=getKnown();if(known==1){return COOKIE_TRW_IE_EMAIL+"="+known}return""},getSessionId=function(){var sessionId=null;var sessionArr=getCookieDataArray(COOKIE_TRW_SESSION_ID);if(sessionArr!=null&&sessionArr.length>0){sessionId=sessionArr[0]}return sessionId},getSessionIdParam=function(){var sessionId=getSessionId();if(sessionId!=null){return COOKIE_TRW_SESSION_ID+"="+sessionId}return""},getClickPerVisit=function(){var cpv=null;var sessionArr=getCookieDataArray(COOKIE_TRW_SESSION_ID);if(sessionArr!=null&&sessionArr.length>1){cpv=parseInt(sessionArr[1]);if(isNaN(cpv)||cpv<1){return null}}return cpv},getCPVParam=function(){var cpv=getClickPerVisit();if(cpv!=null){return COOKIE_TRW_CLICK_PER_VISIT+"="+cpv}return""};var getEmail=function(){var email=AITag.getCookie(COOKIE_TRW_EMAIL);AITag.deleteCookie(COOKIE_TRW_EMAIL);return email},getEmailParam=function(){var email=getEmail();if(email!=null&&email!=="null"){return COOKIE_TRW_EMAIL+"="+email}return""};var getClicksPerVisitFromCookie=function(cookie){var cookieVal=cookie.substring(COOKIE_TRW_CLICK_PER_VISIT.length+1,cookie.length);var tmpArr=cookieVal.split(encodeURIComponent(SESSION_ID_CLICKS_SEPERATOR));return COOKIE_TRW_CLICK_PER_VISIT+"="+tmpArr[1]};this.getCookie=function(name){var cookieVal=null,cookies=document.cookie.split(";");var cookieRegex=RegExp("^\\s*"+name+"=\\s*(.*?)\\s*$");for(var index=0;index<cookies.length;index++){var matches=cookies[index].match(cookieRegex);if(matches&&matches[1]){cookieVal=decodeURIComponent(matches[1]);break}}return cookieVal};this.setCookie=function(name,value,expires,path,secure){var domain=getDomain(window.location.hostname,domainLevel);if(domain=="localhost"){domain=null}document.cookie=name+"="+encodeURIComponent(value)+((expires==null)?"":("; expires="+expires.toGMTString()))+"; path="+((path==null)?"/":path)+((domain==null)?"":("; domain="+domain))+((secure==true)?"; secure":"")};this.deleteCookie=function(name,path,domain,secure){var domain=getDomain(window.location.hostname,domainLevel);if(domain=="localhost"){domain=null}var exp=new Date();exp.setTime(exp.getTime()-1);var cval=this.getCookie(name);document.cookie=name+"="+cval+"; expires="+exp.toGMTString()+"; path="+((path==null)?"/":path)+((domain==null)?"":("; domain="+domain))+((secure==true)?"; secure":"")};this.getCookieVal=function(offset){var endstr=document.cookie.indexOf(";",offset);if(endstr==-1){endstr=document.cookie.length}return decodeURIComponent(document.cookie.substring(offset,endstr))};this.addDynamicScript=function(src,callback,appendToBody,async){var destination;if(appendToBody){destination=document.getElementsByTagName("body")[0]}else{destination=document.getElementsByTagName("head")[0]||document.documentElement}var scriptTimeout=null;var newScript=document.createElement("script");newScript.type="text/javascript";if(src.indexOf("http")!=0&&src.indexOf("https")!=0){src=AITag.getConfig("protocol")+"://"+src}newScript.src=src;newScript.async=async||true;newScript.onload=newScript.onreadystatechange=function(){if(!this.readyState||this.readyState==="loaded"||this.readyState==="complete"){newScript.onload=newScript.onreadystatechange=null;clearTimeout(scriptTimeout);scriptTimeout=null;if(typeof callback==="function"){callback.apply(AITag)}if(destination&&newScript.parentNode){destination.removeChild(newScript)}}};try{scriptTimeout=setTimeout(function(){if(typeof callback==="function"){callback.apply(AITag)}},AITag.getConfig("timeoutDelay")*second)}catch(e){}if(appendToBody){destination.appendChild(newScript)}else{destination.insertBefore(newScript,destination.firstChild)}};this.addDynamicJavaScript=function(scriptContent){var script=document.createElement("script");script.type="text/javascript";try{script.innerHTML=scriptContent}catch(e){script.text=scriptContent}document.body.appendChild(script)};this.addDynamicStyle=function(src){var headID=document.getElementsByTagName("head")[0];var newStyle=document.createElement("link");if(src.indexOf("http")==-1&&src.indexOf("https")==-1){src=AITag.getConfig("protocol")+"://"+src}newStyle.type="text/css";newStyle.href=src;newStyle.rel="stylesheet";headID.appendChild(newStyle)};var addDynamicDiv=function(title,html){var newDiv=document.getElementById("trwDialog");if(!newDiv){newDiv=document.createElement("div");newDiv.setAttribute("id","trwDialog");newDiv.setAttribute("style","display:none;");document.body.appendChild(newDiv)}return AITag.jQuery(newDiv)};this.getStartIndxSearchQuery=function(){var start=-1;var ref=document.referrer;if(ref.search(/google\.*/i)!=-1||ref.search(/altavista\.*/i)!=-1||ref.search(/aol\.*/i)!=-1||ref.search(/alltheweb\.*/i)!=-1||ref.search(/ask\.*/i)!=-1||ref.search(/bing\.*/i)!=-1||ref.search(/walla\.*/i)!=-1){start=ref.search(/q=/)}else{if(ref.search(/yahoo\.*/i)!=-1){start=ref.search(/p=/)}else{if(ref.search(/lycos\.*/i)!=-1){start=ref.search(/query=/)}else{if(ref.search(/dogpile\.*/i)!=-1){start=ref.search(/\/search\/web\/=/)}else{if(ref.search(/dmoz\.*/i)!=-1){start=ref.search(/search=/)}}}}}return start};this.getSearchTerms=function(){var ref=document.referrer;var searchTerms=null;if(ref&&ref!=""){var start=this.getStartIndxSearchQuery();if(start!=-1){searchTerms=ref.substring(start+2);var end=searchTerms.search(/&/);end=(end==-1)?searchTerms.length:end;searchTerms=searchTerms.substring(0,end);if(searchTerms.length!=0){searchTerms=searchTerms.replace(/\+/g," ");searchTerms=decodeURIComponent(searchTerms)}}}return searchTerms};function random(){return"xxxxxxxx".replace(/[x]/g,function(c){var r=Math.random()*16|0;return r.toString(16)})}function generateUUID(){var prefix=AITag.getConfig("accountId");if(prefix){prefix=prefix.replace(".","-")}return prefix+"-"+(new Date).getTime()+"-"+random()}var validateSessionId=function(uuid){if(uuid==null){return false}var token;var tokenized;tokenized=uuid.split("-");if(tokenized.length<3){return false}if(tokenized[tokenized.length-1].length!=8){return false}token=tokenized[tokenized.length-2];if(!(/^\d+$/.test(token))){return false}token="";for(var i=0;i<(tokenized.length-2);i++){token+=tokenized[i]+"."}token=token.substring(0,token.length-1);var aid=AITag.getConfig("accountId");if(!(token==aid.replace(/-/g,"."))){return false}return true};this.createSessionId=function(isEvent){if(this.isNewSession()){newSession=true;sessionId=generateUUID()}var sessionArr=addCPV.call(this,sessionId,isEvent);this.deleteCookie(COOKIE_TRW_SESSION_ID);this.setCookie(COOKIE_TRW_SESSION_ID,sessionArr[0]+COOKIE_VAL_SEPERATOR+sessionArr[1],exp_30_minutes);if(!sessionReady){sessionReady=true;try{runSessionQueue()}catch(e){logMessage("failed to run session ready queue, error: "+e)}}};this.isNewSession=function(){sessionId=this.getCookie(COOKIE_TRW_SESSION_ID);if(!validateSessionId(getSessionId())){sessionId=null}return(sessionId==null)};var addCPV=function(sessionId,isEvent){var firstClick=false;var sessionArr=sessionId.split(COOKIE_VAL_SEPERATOR);if(sessionArr.length>1){sessionArr[1]=parseInt(sessionArr[1],10);if(!isNaN(sessionArr[1])&&sessionArr[1]>0){if(!isEvent&&!eventFirstClick){sessionArr[1]+=1}}}else{var count=this.getCookie(COOKIE_TRW_CLICK_PER_VISIT);if(count!=null){var splitCount=count.split(SESSION_ID_CLICKS_SEPERATOR);var newCount=parseInt(splitCount[1]);if(newCount<1||isNaN(newCount)){newCount=1}newCount=newCount+1;sessionArr[1]=newCount}else{firstClick=true;sessionArr[1]=1}}if(isNaN(sessionArr[1])||sessionArr[1]<1){sessionArr[1]="1"}if(isEvent&&firstClick&&!eventFirstClick){eventFirstClick=true}else{eventFirstClick=false}return sessionArr};var addVC=function(visitorId){var visitorArr=visitorId.split(COOKIE_VAL_SEPERATOR);if(visitorArr.length>1){if(this.isNewSession()){var visitCount=parseInt(visitorArr[1],10);if(visitCount<1||isNaN(visitCount)){visitCount=0}visitorArr[1]=visitCount+1}}else{var count=this.getCookie(COOKIE_TRW_COUNT);if(count!=null){visitorArr[1]=parseInt(count,10);if(visitorArr[1]<1||isNaN(visitorArr[1])){visitorArr[1]=1}if(this.isNewSession()){visitorArr[1]=parseInt(visitorArr[1],10)+1}}else{visitorArr[1]=1}}var visitCount=parseInt(visitorArr[1],10);if(visitCount<1||isNaN(visitCount)){visitorArr[1]="1"}return visitorArr};function copyVcCookie(){var visitorId=AITag.getCookie(COOKIE_TRW_VISITOR_UID);if(visitorId!=null){var visitorArr=visitorId.split(COOKIE_VAL_SEPERATOR);var count=AITag.getCookie(COOKIE_TRW_COUNT);if(count!=null){visitorArr[1]=parseInt(count);var visitor=visitorArr[0]+COOKIE_VAL_SEPERATOR+visitorArr[1];var known=AITag.getCookie(COOKIE_TRW_IE_EMAIL);if(known!=null){visitor+=COOKIE_VAL_SEPERATOR+1}AITag.setCookie(COOKIE_TRW_VISITOR_UID,visitor,exp_2_year)}}}function copyCpvCookie(){if(!AITag.isNewSession()){var sessionArr=sessionId.split(COOKIE_VAL_SEPERATOR);var count=AITag.getCookie(COOKIE_TRW_CLICK_PER_VISIT);if(count!=null){var splitCount=count.split(SESSION_ID_CLICKS_SEPERATOR);var newCount=parseInt(splitCount[1]);sessionArr[1]=newCount;AITag.setCookie(COOKIE_TRW_SESSION_ID,sessionArr[0]+COOKIE_VAL_SEPERATOR+sessionArr[1],exp_30_minutes)}}}this.isNewVisitor=function(){var visitorId=this.getCookie(COOKIE_TRW_VISITOR_UID);if(visitorId==null){newVisitor=true}return newVisitor};this.addVisitorId=function(isKnown){var visitorId=this.getCookie(COOKIE_TRW_VISITOR_UID);if(visitorId==null){newVisitor=true;visitorId=generateUUID()}else{this.deleteCookie(COOKIE_TRW_VISITOR_UID)}var visitorArr=addVC.call(this,visitorId);var visitor=visitorArr[0]+COOKIE_VAL_SEPERATOR+visitorArr[1];if(visitorArr.length>2||isKnown){visitor+=":1"}this.setCookie(COOKIE_TRW_VISITOR_UID,visitor,exp_2_year)};var addToTimelineImp=function(reactionId){if(reactionId!==undefined&&reactionId!=null){var reactions=AITag.getCookie(COOKIE_TRW_IE_CPN);if(reactions!==undefined&&reactions!=null&&reactions.indexOf(reactionId)==-1){AITag.deleteCookie(COOKIE_TRW_IE_CPN);reactions+=COOKIE_VAL_SEPERATOR+reactionId+IMPRESSION_SUFFIX}else{reactions=reactionId+IMPRESSION_SUFFIX}AITag.setCookie(COOKIE_TRW_IE_CPN,reactions,exp_2_year)}};var addToTimelineConv=function(reactionId){if(reactionId!==undefined&&reactionId!=null){var reactions=AITag.getCookie(COOKIE_TRW_IE_CPN);if(reactions!==undefined&&reactions!=null){AITag.deleteCookie(COOKIE_TRW_IE_CPN);if(reactions.indexOf(reactionId)==-1){reactions+=COOKIE_VAL_SEPERATOR+reactionId+CONVERSION_SUFFIX}else{reactions=reactions.replace(reactionId+IMPRESSION_SUFFIX,reactionId+CONVERSION_SUFFIX)}}else{reactions=reactionId+CONVERSION_SUFFIX}AITag.setCookie(COOKIE_TRW_IE_CPN,reactions,exp_2_year)}};this.disableTag=function(iframe){config.disableClick=true;config.disablePoll=true;config.googleAnalytics=false;config.enableUAnalytics=false;config.enableSiteCatalyst=false;config.trackAsset=false;config.enableRecommendationBar=false;if(window.rtp){window.rtp.d=true}if(iframe){AITag.updateInitialConfig();var email=getEmail();if(email!==undefined&&email!=null&&email!=""){sendLead(email)}}};this.previewCallback=function(msg,isBindConversion,onSite){if(config===undefined||config==null){config={}}if(!window.AIConfig){window.AIConfig={}}if(!window.IeraPreview){window.IeraPreview={}}previewMode=true;config.stratup=false;config.disableClick=true;config.disablePoll=true;config.googleAnalytics=false;config.enableUAnalytics=false;config.enableSiteCatalyst=false;config.trackAsset=false;config.enableRecommendationBar=false;config.captureLeads=false;AITag.updateInitialConfig.apply(AITag);if(typeof window.IeraPreview.previewShowed!="undefined"&&window.IeraPreview.previewShowed){return}else{window.IeraPreview.previewShowed=true}AITag.loadCss.apply(AITag);var afterFullyLoaded=function(){this.fullyLoaded=true;runCampaignQueue()};if(!onSite){msg=decodeURIComponent(msg)}var msgObj=JSON.parse(msg);AITag.msgCallback(msgObj,null,msgObj.isBindConversion);AITag.loadJQuery(afterFullyLoaded)};this.pollMsg=function(callback,showCampaign){if(!checkIESupported()){return}if(callback){this.campaignCallback=callback}if(showCampaign){this.showCampaign=showCampaign}AITag.pollIntervalCounter++;var url=AITag.getConfig("gwUrlPrefix")+"/msg?a=2&sid="+getSessionId()+"&aid="+AITag.getConfig("accountId");var mktoTrk=this.getCookie(COOKIE_MARKETO_TOKEN);if(typeof mktoTrk!="undefined"&&mktoTrk!=null&&mktoTrk!=""){url+="&ma="+encodeURIComponent(mktoTrk)}url=addToParams(url,{viewedTypes:encodeURIComponent(viewedTypes.join())});msgCallTime=new Date().getTime();if(AITag.getConfig("pollingPerPage")<=AITag.pollIntervalCounter){AITag.addDynamicScript(url+"&"+Math.random()+"&rts="+msgCallTime,AITag.showInzoneElements)}else{AITag.addDynamicScript(url+"&"+Math.random()+"&rts="+msgCallTime)}logMessage("msg called. Time since view: "+(msgCallTime-viewTime))};var addCampaignToRTPGlobal=function(reactionId,type){var rtpGlobal=window.rtp;if(rtpGlobal&&rtpGlobal.userContext){var campaignList;if(type==0){campaignList=rtpGlobal.userContext.viewedCampaigns}else{if(type==1){campaignList=rtpGlobal.userContext.clickedCampaigns}}if(!campaignList){campaignList=[]}reactionId=reactionId.toString();if(campaignList.indexOf(reactionId)==-1){campaignList.push(reactionId)}if(type==0){window.rtp.userContext.viewedCampaigns=campaignList}else{if(type==1){window.rtp.userContext.clickedCampaigns=campaignList}}}};var runCounter=0;function runAsyncQueue(){if(nonjQueryCampaignQueue&&nonjQueryCampaignQueue.length>0){logMessageTime("try to run campaigns that doesn't require jQuery, intervarl number: "+runCounter+". Time since DOM loading: ",new Date().getTime());runCounter++;inzoneCampginTimoutSet=false;var queueLength=nonjQueryCampaignQueue.length;for(var i=0;i<queueLength;i++){var param=nonjQueryCampaignQueue.shift();var method=param.shift();try{AITag[method].apply(AITag,param)}catch(e){}}}}this.runAsyncQueue=function(){runAsyncQueue()};function executeScript(scriptElement){var syncScriptUrl=null;var async=true;if(scriptElement.src!==undefined&&scriptElement.src!=""){async=scriptElement.async===undefined?scriptElement.async:false;if(async){AITag.addDynamicScript(scriptElement.src,null,false,async)}else{syncScriptUrl=scriptElement.src}}else{(function(script){eval.call(window,script)})((scriptElement.text||scriptElement.textContent||scriptElement.innerHTML||""))}return syncScriptUrl}function executeInnerScripts(campaign,isBindConversion,runBindOnload){var div=document.createElement("div");div.innerHTML="_"+campaign.content;var nodes=div.childNodes;div=null;var node;var syncScriptUrl=null;var pendingScripts=[];for(var i=0;nodes[i]!=null;i++){node=nodes[i];if(typeof node.getElementsByTagName!=="undefined"){var scripts=node.getElementsByTagName("script");if(scripts!==undefined&&scripts!=null){for(var j=0;j<scripts.length;j++){if(syncScriptUrl!=null){pendingScripts.push(scripts[j])}else{syncScriptUrl=executeScript(scripts[j])}}}}if(node.nodeName.toLowerCase()=="script"){if(syncScriptUrl!=null){pendingScripts.push(node)}else{syncScriptUrl=executeScript(node)}}}if(syncScriptUrl!=null){AITag.addDynamicScript(syncScriptUrl,(function(pendingScripts,campaign,isBindConversion,runBindOnload){return function(){for(var i=0;i<pendingScripts.length;i++){executeScript(pendingScripts[i])}AITag.afterFormsServed(campaign,isBindConversion,runBindOnload)}})(pendingScripts,campaign,isBindConversion,runBindOnload),false,false)}return syncScriptUrl!=null}this.afterFormsServed=function(campaign,isBindConversion,runBindOnload){if(campaignForms2.indexOf(campaign.reactionId)>-1&&window.MktoForms2){if(runBindOnload&&(typeof isBindConversion==="undefined"||!isBindConversion)){AITag.bindConversion(campaign.reactionId,campaign.requestId,campaign.div)}MktoForms2.whenReady(function(form){if(allowedForms2.indexOf(""+form.getId())>-1){if(campaign.div&&campaign.div.showDialogCallback){campaign.div.showDialogCallback()}}})}else{if(campaign.div&&campaign.div.showDialogCallback){campaign.div.showDialogCallback()}}};var presentedCampaigns={},hiddenElementsShown=false;function pushCampaignData(msg,requestId,isBindConversion){try{if(isBindConversion===undefined&&msg.sticky){campaignStorage.exc(["storeCampaign",msg,requestId])}}catch(e){logMessage("failed to store sticky campaign")}if(isAnalyticsEnabled()&&isBindConversion!=false){try{iiq.push(["pushCampaign",msg.reactionId,"Impression",msg.reactionName,msg.segmentName,getSessionId(),msg.campaignLabels])}catch(e){}}try{if(AITag.getConfig("userContextAPI")){var visitCount=getVisitCount();if(visitCount!=null){rtp("add","toCmpTl",visitCount,msg.reactionId,0)}addCampaignToRTPGlobal(msg.reactionId,0)}}catch(e){}presentedCampaigns[msg.reactionId]=true;if(!hiddenElementsShown){AITag.showInzoneElements()}}var activeCampaignMap={},inzoneCampaignTimeout=null,inzoneCampginTimoutSet=false,MAX_LOADING_TIME=5000,campaignForms2=[],allowedForms2=[];function injectInzoneCampaign(msg,requestId,isBindConversion){var replaced=false;var targetDiv=msg.targetDiv;logMessage("trying to inject inzone campaign "+targetDiv);var element=document.getElementById(targetDiv);if(element&&element.id==targetDiv){executeInnerScripts(msg,isBindConversion,false);element.innerHTML=msg.content;if(typeof isBindConversion==="undefined"||!isBindConversion){cpq.push(["bindConversionListener",targetDiv,msg.reactionId,requestId])}pushCampaignData(msg,requestId,isBindConversion);logMessageTime("changed div "+targetDiv+" after: ",new Date().getTime());replaced=true}else{if(!activeCampaignMap[msg.reactionId]){activeCampaignMap[msg.reactionId]=[msg,requestId,isBindConversion];injectScript("body","LAST","(function(){AITag.activateCampaign("+msg.reactionId+");})()")}}return replaced}this.activateCampaign=function(reactionId){var campaignData=activeCampaignMap[reactionId];if(campaignData){logMessage("Try to inject with script in body");AITag.msgCallback.apply(AITag,campaignData)}};this.msgCallback=function(msg,requestId,isBindConversion,storedCampaign){try{if(AITag.campaignCallback&&typeof AITag.campaignCallback=="function"){AITag.campaignCallback(msg,requestId,isBindConversion);if(!AITag.showCampaign){return}}}catch(e){}if(presentedCampaigns[msg.reactionId]>-1){logMessage(msg.reactionId+" is already presented on page, can't show twice");return}msg.requestId=requestId;var targetDiv=msg.targetDiv;if(!previewMode&&currentPageAllowedCampaigns.indexOf(msg.reactionId)==-1&&allPagesAllowedCampaigs.indexOf(msg.reactionId)==-1){logMessage("Campaign "+msg.reactionName+" not allowed on current page");return}if(storedCampaign){switch(msg.viewType){case"WIDGET":case"DIALOG":viewedTypes.push("dialog/widget");break;case"IN_ZONE":viewedTypes.push(msg.viewType+msg.targetDiv);break;case"REDIRECT":viewedTypes.push("$$$REDIRECT$$$");default:logMessage("unsupported type: "+msg.viewType);break}}if(msg.content.indexOf("MktoForms2")>-1){campaignForms2.push(msg.reactionId)}if(!this.fullyLoaded){if(targetDiv&&targetDiv!=""&&targetDiv!="widget"&&(msg.useEffect!=true&&msg.useEffect!="true")){if(isReady){injectInzoneCampaign(msg,requestId,isBindConversion)}else{var isInjected=injectInzoneCampaign(msg,requestId,isBindConversion);if(!isInjected){logMessage("Inzone campaign not injected, inserting into queue");nonjQueryCampaignQueue.push(["msgCallback",msg,requestId,isBindConversion]);(!inzoneCampginTimoutSet&&(new Date().getTime()-scriptExecutionTime<MAX_LOADING_TIME)&&AITag.getConfig("campaignInjectionInterval")>0)?(inzoneCampaignTimeout=setTimeout(runAsyncQueue,runCounter==0?10:AITag.getConfig("campaignInjectionInterval")),inzoneCampginTimoutSet=true):false}}}else{cpq.push(["msgCallback",msg,requestId,isBindConversion])}return}logMessageTime("displaying campaign "+msg.reactionName+" with regular flow. The time since DOM loading: ",new Date().getTime());pushCampaignData(msg,requestId,isBindConversion);var redirect=msg.redirect;if(redirect==true||redirect=="true"){var uri=msg.redirectUrl;if(uri.indexOf("http://")==-1&&uri.indexOf("https://")==-1){uri="http://"+uri}window.location=uri}else{var $div=AITag.getReactionDiv(msg);AITag.putReactionInDiv.call(AITag,$div,msg.content,msg.reactionId,requestId,msg.targetDiv,msg.useEffect,msg.effectType,isBindConversion);if(msg.content.indexOf("MktoForms2")>-1){var forms=$div.find("form");var id=null;AITag.jQuery(forms).each(function(){id=AITag.jQuery(this).attr("id");id=id.split("_");allowedForms2.push(id[1])})}msg.div=$div;var hasSyncScript=executeInnerScripts(msg,isBindConversion,true);if(msg.content.indexOf("MktoForms2")==-1||!hasSyncScript){if(typeof $div!="undefined"){if($div.showDialogCallback){$div.showDialogCallback()}}}}};this.getReactionDiv=function(msg){var targetDiv=msg.targetDiv;if(targetDiv=="widget"){var widgetContentId=InsighteraWidget.getContentId();if(!InsighteraWidget.isInitilized()){InsighteraWidget.init({widgetPositionTop:((msg.widgetVerticalPosition===undefined)?undefined:msg.widgetVerticalPosition+"%"),widgetPositionSide:msg.widgetSidePosition,tabColor:msg.widgetBackgroundColor,contentColor:msg.widgetBackgroundColor})}$div=AITag.jQuery("#"+widgetContentId);$div.showDialogCallback=function(){InsighteraWidget.show()};return $div}else{if(targetDiv&&targetDiv!=""){if(targetDiv=="redirect"){var uri=AITag.jQuery(msg.content).text().trim();if(uri.indexOf("http://")==-1&&uri.indexOf("https://")==-1){uri="http://"+uri}window.location=uri}return AITag.jQuery("#"+targetDiv)}else{var resizable=msg.resizable!=undefined&&(msg.resizable==true||msg.resizable=="true");var modal=msg.modal!=undefined&&(msg.modal==true||msg.modal=="true");var height=msg.height;var width=msg.width;var dialogShowDuration=msg.dialogOpenDuration;var headerColor=msg.dialogHeaderBackground;var contentBackgroundColor=msg.dialogContentBackground;var title=msg.dialogTitle;return showDialog(msg.dialogType,msg.hPos,msg.vPos,title,modal,resizable,height,width,dialogShowDuration,headerColor,contentBackgroundColor,title,msg.autoWidth,msg.fitWidth)}}};var showDialog=function(dialogType,hPos,vPos,title,isModal,isResizable,height,width,dialogShowDuration,headerColor,contentBackgroundColor,dialogTitle,autoWidth,fitWidth){if(isDialogPresented){return}isDialogPresented=true;if(AITag.getConfig("title")!=null&&AITag.getConfig("title")!=""){title=AITag.getConfig("title")}if(typeof dialogTitle=="undefined"||dialogTitle==null){dialogTitle=""}var $div=addDynamicDiv(title);var hideSide="left";if(!(/^\d+$/.test(hPos))){hideSide=hPos}else{var windowWidth=AITag.jQuery(window).width();if(hPos*1>windowWidth/2){hideSide="right"}}var hAt=null,vAt=null;if(vPos=="middle"){vPos="center"}if(/^\d+$/.test(hPos)){hPos="left+"+hPos}if(/^\d+$/.test(vPos)){vPos="top+"+vPos}var dialogArgs=AITag.getConfig("dialogArgs");if(dialogArgs==null){dialogArgs={autoOpen:false,resizable:isResizable,show:"blind",title:dialogTitle,hide:{effect:"drop",direction:hideSide,duration:1000},modal:isModal,minHeight:50,position:{at:hPos+" "+vPos,of:window},dialogClass:"insightera"}}if(height!=undefined){dialogArgs.height=height}if(autoWidth){dialogArgs.width="auto"}else{if(fitWidth){var winW=(window.innerWidth>0)?window.innerWidth:screen.width;var winH=(window.innerHeight>0)?window.innerHeight:screen.height;dialogArgs.height=winH+30;dialogArgs.width=winW}else{if(width!=undefined){dialogArgs.width=width}}}$div.showDialogCallback=function(){var dialog=$div.dialog(dialogArgs);dialog.parent(".ui-dialog").addClass("insightera-dialog");if(dialogType=="MODERN_TRIM"){dialog.parent(".ui-dialog").addClass("insightera-dialog-modern-trim");dialog.parent(".ui-dialog").find(".ui-widget-header").removeClass("ui-corner-all");if(dialogTitle==""||dialogTitle===undefined||dialogTitle==null){dialog.parent(".ui-dialog").find(".ui-dialog-title").html("")}var imageUrl=cdnSrc+AITag.getConfig("dialogCloseButton");dialog.parent(".ui-dialog").find(".ui-widget-header .ui-icon").css("background-image","url("+imageUrl+")")}else{if(dialogType=="TRANSPARENT"){dialog.parent(".ui-dialog").addClass("insightera-dialog-transparent");var imageUrl=cdnSrc+AITag.getConfig("dialogTransparentButton");dialog.parent(".ui-dialog").find(".ui-widget-header .ui-dialog-titlebar-close").css("background-image","url("+imageUrl+")")}else{if(dialogType=="MODERN_TRIM_2"){dialog.parent(".ui-dialog").addClass("insightera-dialog-modern-trim-2");var imageUrl=cdnSrc+AITag.getConfig("moderntrim2CloseButton");dialog.parent(".ui-dialog").find(".ui-widget-header .ui-dialog-titlebar-close").css("background-image","url("+imageUrl+")")}}}try{AITag.jQuery("body").bind("click",function(e){if(dialog.dialog("isOpen")&&!AITag.jQuery(e.target).is(".ui-dialog, a")&&!AITag.jQuery(e.target).closest(".ui-dialog").length){dialog.dialog("close")}})}catch(e){}dialog.dialog("open");if(typeof headerColor!="undefined"&&headerColor!=null&&headerColor!="#CCCCCC"&&headerColor!="#ccc"&&headerColor!=""&&dialogType!="TRANSPARENT"){AITag.jQuery(".insightera .ui-widget-header").css("background",headerColor)}if(typeof contentBackgroundColor!="undefined"&&contentBackgroundColor!=null&&contentBackgroundColor!="#FFFFFF"&&contentBackgroundColor!="#fff"&&contentBackgroundColor!=""&&dialogType!="TRANSPARENT"){AITag.jQuery(".insightera #trwDialog").css("background",contentBackgroundColor)}var duration;if(typeof dialogShowDuration!="undefined"&&dialogShowDuration!=null){duration=dialogShowDuration}else{duration=AITag.getConfig("dialogCloseTime")}if(!AITag.jQuery.support.opacity){AITag.jQuery(".ui-widget-overlay").css("filter","alpha(opacity=30)")}AITag.jQuery(".ui-widget-overlay").css("z-index","9998");if(duration!=-1){window.setTimeout(function(){if(dialog.is(":visible")){dialog.dialog("close")}},duration*1000)}};return $div};this.conversionCallback=function(){AITag.loadState="conversion callback"};var getConversionParams=function(reactionId,requestId){var params="";var visitorId=getVisitorId();if(InsighteraUtil.validateParam(visitorId)){params+="&v="+AITag.escapePercent(visitorId)}if(InsighteraUtil.validateParam(reactionId)){params+="&s="+reactionId}if(InsighteraUtil.validateParam(requestId)){params+="&reqid="+requestId}var sessionId=getSessionId();if(InsighteraUtil.validateParam(sessionId)){params+="&trwsa.sid="+sessionId}return params};function registerConversion(reactionId){try{if(isAnalyticsEnabled()){iiq.push(["pushCampaign",reactionId,"Conversion",undefined,undefined,getSessionId()])}}catch(e){}try{if(AITag.getConfig("userContextAPI")){var visitCount=getVisitCount();if(visitCount!=null){rtp("add","toCmpTl",visitCount,reactionId,1)}addCampaignToRTPGlobal(reactionId,1)}}catch(e){}}this.bindConversionListener=function(elementId,reactionId,requestId){var element=this.jQuery("#"+elementId);if(element&&element.length>0){AITag.bindConversion(reactionId,requestId,element)}};this.bindConversion=function(reactionId,requestId,$div){var urlBase=AITag.getConfig("gwUrlPrefix")+"/trw?cmd=1&aid="+AITag.getConfig("accountId")+getConversionParams(reactionId,requestId);var mktoTrk=this.getCookie(COOKIE_MARKETO_TOKEN);if(typeof mktoTrk!="undefined"&&mktoTrk!=null&&mktoTrk!=""){urlBase+="&ma="+encodeURIComponent(mktoTrk)}if(campaignForms2.indexOf(reactionId)>-1){var forms=$div.find("form");var id=null;AITag.jQuery(forms).each(function(){id=AITag.jQuery(this).attr("id");id=id.split("_");allowedForms2.push(id[1])});if(window.MktoForms2){window.MktoForms2&&MktoForms2.whenReady(function(form){if(allowedForms2.indexOf(""+form.getId())>-1){form.onSuccess(function(values,followUpUrl){var ajaxUrl=urlBase+"&cb=AITag.conversionCallback";registerConversion(reactionId);forms2Submitted(form);AITag.addDynamicScript(ajaxUrl,(function(followUpUrl){if(!form.doNotRedirect){followUpUrl=removeURIParam(followUpUrl,["iesrc"]);followUpUrl=addParams2URI(followUpUrl,{iesrc:"ctr"});location.href=followUpUrl}})(followUpUrl));return false})}})}else{setTimeout(function(){window.MktoForms2&&MktoForms2.whenReady(function(form){if(allowedForms2.indexOf(""+form.getId())>-1){form.onSuccess(function(values,followUpUrl){var ajaxUrl=urlBase+"&cb=AITag.conversionCallback";registerConversion(reactionId);forms2Submitted(form);AITag.addDynamicScript(ajaxUrl,(function(followUpUrl){if(!form.doNotRedirect){followUpUrl=removeURIParam(followUpUrl,["iesrc"]);followUpUrl=addParams2URI(followUpUrl,{iesrc:"ctr"});location.href=followUpUrl}})(followUpUrl));return false})}})},6000)}}else{var forms=$div.find("form");if(forms&&forms.length>0){AITag.checkForEmailTextField()}$div.find("form").submit(function(event){var ajaxUrl=urlBase+"&cb=AITag.conversionCallback";registerConversion(reactionId);AITag.addDynamicScript(ajaxUrl)})}$div.find("a,:submit,:button").click(function(event){var ajaxUrl=urlBase+"&cb=AITag.conversionCallback";var targetElement=event.target||event.srcElement;var parent=AITag.jQuery(targetElement).parents("a");if(targetElement.tagName=="A"){var href=targetElement.href;href=removeURIParam(href,["iesrc"]);href=addParams2URI(href,{iesrc:"ctr"});targetElement.href=href}else{if(parent.get(0)){var parentEl=parent.get(0);if(parentEl.tagName=="A"){var href=parentEl.href;href=removeURIParam(href,["iesrc"]);href=addParams2URI(href,{iesrc:"ctr"});parentEl.href=href}}}registerConversion(reactionId);AITag.addDynamicScript(ajaxUrl)});$div.find("a").each(function(){var $a=AITag.jQuery(this);var href=$a.attr("href");campaignLinks[href]=true;href=removeURIParam(href,["iesrc"]);href=addParams2URI(href,{iesrc:"ctr"});$a.attr("href",href)});$div.find("a").click(function(event){var $a=AITag.jQuery(event.currentTarget);var href=$a.attr("href");var target=$a.attr("target");var first3=href.substr(0,3).toLowerCase();if(first3!="www"&&first3!="htt"){return}href=removeURIParam(href,["iesrc"]);href=addParams2URI(href,{iesrc:"ctr"});var redirectUrl=AITag.getConfig("protocol")+"://"+urlBase+"&rd="+encodeURIComponent(href.replace(/\+/g,"%2B"));registerConversion(reactionId);if(!target||TARGET_VAL.indexOf(target)>-1){$a.attr("href",redirectUrl)}})};function injectContent(element,content){var div=document.createElement("div");div.innerHTML="_"+content;var nodes=div.childNodes;var node;for(var i=0;nodes[i]!=null;i++){node=nodes[i];if(typeof node.getElementsByTagName!=="undefined"){var scripts=node.getElementsByTagName("script");if(scripts!==undefined&&scripts!=null){for(var j=scripts.length-1;j>=0;j--){scripts[j].parentNode.removeChild(scripts[j])}}}if(node.nodeName.toLowerCase()=="script"){node.parentNode.removeChild(node)}}element.innerHTML=div.innerHTML.substring(1,div.innerHTML.length)}this.putReactionInDiv=function($div,reactionHTMLCode,reactionId,requestId,targetDiv,useEffect,effectType,isBindConversion){if(typeof targetDiv!="undefined"&&targetDiv!=null&&targetDiv!="widget"&&(useEffect==true||useEffect=="true")){logMessage("replacing div "+targetDiv+" with effect "+effectType);$div.hide(0,function(){try{injectContent($div.get(0),reactionHTMLCode);var selectedEffect=effectType.toLowerCase();var options={};if(selectedEffect==="scale"){options={percent:0}}else{if(selectedEffect==="transfer"){options={to:"#button",className:"ui-effects-transfer"}}else{if(selectedEffect==="size"){options={to:{width:200,height:60}}}}}$div.effect(selectedEffect,options,1000,function(){});logMessage("HTML was replaced for div "+targetDiv+" with effect "+effectType);if(typeof isBindConversion==="undefined"||!isBindConversion){AITag.bindConversion(reactionId,requestId,$div)}}catch(e){logMessage("failed to inject div "+targetDiv+". error: "+e.message)}})}else{injectContent($div.get(0),reactionHTMLCode);if(typeof isBindConversion==="undefined"||!isBindConversion){AITag.bindConversion(reactionId,requestId,$div)}}};this.emailCallback=function(){AITag.deleteCookie(COOKIE_TRW_EMAIL)};var getLeadParams=function(email){var params="";AITag.addVisitorId();var visitorId=getVisitorId();if(InsighteraUtil.validateParam(visitorId)){params+="&v="+visitorId}if(InsighteraUtil.validateParam(email)){params+="&e="+email}var sessionId=getSessionId();if(!InsighteraUtil.validateParam(sessionId)){AITag.createSessionId(true);sessionId=getSessionId()}if(InsighteraUtil.validateParam(sessionId)){params+="&trwsa.sid="+sessionId}params+="&"+getVCParam();return params};var sendLead=function(email,callback){var params=AITag.getConfig("gwUrlPrefix")+"/trw?cmd=2&cb=AITag.emailCallback&aid="+AITag.getConfig("accountId")+getLeadParams(email);var mktoTrk=AITag.getCookie(COOKIE_MARKETO_TOKEN);if(typeof mktoTrk!="undefined"&&mktoTrk!=null&&mktoTrk!=""){params+="&ma="+encodeURIComponent(mktoTrk)}AITag.addDynamicScript(params,callback)};this.foundEmail=function(email,callback){if(email!=null){AITag.setCookie(COOKIE_TRW_EMAIL,email,exp_30_minutes);AITag.addVisitorId(true);sendLead(email,callback)}};this.checkForEmailTextFields=function(){if(AITag.getConfig("captureLeads")){AITag.checkForEmailTextField()}};this.bindEvent=function(element,eventType,eventFunction,extraParameter){AITag.jQuery(element).bind(eventType,eventFunction)};function bindMLMForm1(){var buttonAttached=false;try{var emailField=getEmailField("Email");var button=getButton("mktFrmSubmit");if(emailField.length>0&&button.length>0){buttonAttached=true;var events=button.attr("onclick");button.removeAttr("onclick");AITag.bindEvent(button,"click",function(emailField,events){return function(){var email=emailField.val();var func;if(typeof events==="function"){func=events}else{func=new Function(events)}if(typeof email!="undefined"&&email!=""){var callback=function(){try{return func.apply()}catch(e){}var form=emailField.parents("form");form.submit()};AITag.foundEmail(emailField.val(),callback);return false}else{return func.apply()}}}(emailField,events))}}catch(e){logMessage("failed to bind MLM form 1")}return buttonAttached}function getButton(buttonName){var $buttons=AITag.jQuery("a,:submit,:button");var button=$buttons.filter("#"+buttonName);if(button.length==0){button=$buttons.find('[name="'+buttonName+'"]');if(button.length==0){button=$buttons.find('[value="'+buttonName+'"]');if(button.length==0){$buttons.each(function(index){if(AITag.jQuery(this).text()==buttonName){if(button.length==0){button=AITag.jQuery(this)}else{button.add(this)}}})}}}return button}function getEmailField(fieldName){var emailField=AITag.jQuery('input:text[name="'+fieldName+'"]');if(emailField.length==0){emailField=AITag.jQuery('input:text[id="'+fieldName+'"]')}if(emailField.length==0){emailField=AITag.jQuery('input[name="'+fieldName+'"]')}if(emailField.length==0){emailField=AITag.jQuery('input[id="'+fieldName+'"]')}if(emailField.length==0){emailField=AITag.jQuery('input[class|="'+fieldName+'"]')}return emailField}function formSubmitted(form){var passwordFileds=AITag.jQuery(form).find("input[type='password']");if(passwordFileds&&passwordFileds.length==1){return}AITag.jQuery(form).find(":input").each(function(){var val=AITag.jQuery(this).val();if(EMAIL_REG.test(val)){var email=val;if(typeof email!="undefined"&&email!=""){AITag.foundEmail(email)}}})}function forms2Submitted(form){formSubmitted(form.getFormElem())}this.checkForEmailTextField=function(){if(window.MktoForms2){MktoForms2.whenReady(function(form){form.onSubmit(function(){if(allowedForms2.indexOf(""+form.getId())==-1){forms2Submitted(form)}})})}var fieldNames=AITag.getConfig("mailTextField");var fieldButtonMap=AITag.getConfig("fieldButtonMap");var buttonNames=null,buttonName,buttonAttached=false;var emailField;buttonAttached=bindMLMForm1();if(fieldNames){if(typeof fieldNames==="string"){fieldNames=[fieldNames]}for(var i=0;i<fieldNames.length;i++){var fieldName=fieldNames[i];if(fieldName){try{emailField=getEmailField(fieldName);if(emailField.length==0){continue}}catch(e){if(window.console&&window.console.log&&window.console.log.apply){console.log("fail to find input "+e)}}if(fieldButtonMap!==undefined&&fieldButtonMap!=null){buttonNames=fieldButtonMap[fieldName]}else{buttonNames=AITag.getConfig("mailButton")}if(typeof buttonNames==="string"){buttonNames=[buttonNames]}if(buttonNames){for(var j=0;j<buttonNames.length;j++){buttonName=buttonNames[j];if(buttonName){try{var button=getButton(buttonName)}catch(e){if(window.console&&window.console.log&&window.console.log.apply){console.log("fail to find input button "+e)}}try{if(button.length>0&&buttonName=="mktFrmSubmit"){buttonAttached=true;var events=button.attr("onclick");button.removeAttr("onclick");AITag.bindEvent(button,"click",function(emailField,events){return function(){var email=emailField.val();var func;if(typeof events==="function"){func=events}else{func=new Function(events)}if(typeof email!="undefined"&&email!=""){var callback=function(){try{return func.apply()}catch(e){}var form=emailField.parents("form");form.submit()};AITag.foundEmail(emailField.val(),callback);return false}else{return func.apply()}}}(emailField,events))}else{if(button.length>0){buttonAttached=true;AITag.bindEvent(button,"click",function(emailField){return function(){var email=emailField.val();if(typeof email!="undefined"&&email!=""){AITag.foundEmail(email)}}}(emailField))}}}catch(e){if(window.console&&window.console.log&&window.console.log.apply){console.log("fail to bind click event on button "+e)}}}}}if(!buttonAttached){AITag.bindEvent(emailField.parents("form"),"submit",function(emailField){return function(){var email=AITag.jQuery(emailField).val();if(typeof email!="undefined"&&email!=""){AITag.foundEmail(email)}}}(emailField))}}}}else{if(AITag.getConfig("getAllEmails")){var forms=AITag.jQuery("form");forms.each(function(){AITag.jQuery(this).submit(function(){var id=AITag.jQuery(this).attr("id");if(!id||id.indexOf("mktoForm")==-1){formSubmitted(this)}})})}}};this.runAnalyticsIntegration=function(){if(isAnalyticsEnabled()){logMessageTime("import analytics. Time since DOM loading: ",new Date().getTime());this.addDynamicScript(cdnSrc+GA_CDN_PATH,function(){})}};this.activateCampaignStorage=function(){try{if(checkIESupported()){campaignStorage.exc(["init"]);campaignStorage.exc(["showStoredCampaigns"])}}catch(e){logMessage("failed to load stored campaigns. error: "+e.message)}};this.state="pre-startup";this.startup=function(){if(!window.AIConfig){window.AIConfig={}}this.updateInitialConfig.apply(AITag);this.loadState="post-startup";if(typeof this.pollInterval=="undefined"||this.pollInterval==null){this.pollInterval=""}if(typeof isDialogPresented=="undefined"||isDialogPresented==null){isDialogPresented=false}this.pollIntervalCounter=0;this.activateCampaignStorage();try{this.activateRecommendation.apply(AITag)}catch(e){}try{this.runAnalyticsIntegration.apply(AITag)}catch(e){}this.go();try{bindMessageEvent()}catch(e){}};this.loadCss=function(){if(!this.getConfig("jqueryUiCssExistsOnPage")){this.addDynamicStyle(cdnSrc+this.getConfig("jQueryUICustomCssPath"))}else{this.addDynamicStyle(cdnSrc+this.getConfig("requiredCssPath"))}};function sendMktoToken(){var mktoParam=this.extractURLParameter("mkt_tok");if(mktoParam!=null&&mktoParam!=""&&!mktoExistOnClick){var firstIntervalTime=null;getMktoTokenInterval=setInterval(function(){logMessage("get mkto cookie interval called");if(firstIntervalTime==null){firstIntervalTime=(new Date).getTime()}var mktoTrkExists=false;var mktoTrk=AITag.getCookie(COOKIE_MARKETO_TOKEN);if(typeof mktoTrk!="undefined"&&mktoTrk!=null&&mktoTrk!=""){mktoTrkExists=true;AITag.addDynamicScript(AITag.getConfig("gwUrlPrefix")+"/put/munchkinId?aid="+AITag.getConfig("accountId")+"&id="+encodeURIComponent(mktoTrk))}if(((new Date).getTime()-firstIntervalTime>20000)||mktoTrkExists){logMessage("clearing interval for get marketo");clearInterval(getMktoTokenInterval)}},50)}}this.sendEvent=function(data){this.addVisitorId();this.createSessionId(true);var query="";var sid=getSessionIdParam();if(sid==""){return}query+="&"+sid;var vid=getVisitorIdParam();if(vid==""){return}query+="&"+vid;if(!data||typeof data!="object"||!data.value){return}var vcParam=getVCParam();query+=(vcParam!="")?("&"+vcParam):"";if(typeof data.value==="string"){data.value=[data.value]}query=addToParams(query,{pm:currentPageAllowedCampaigns.join()});query+="&rtp.ev="+JSON.stringify(data);var mktoTrk=this.getCookie(COOKIE_MARKETO_TOKEN);var params=this.getConfig("gwUrlPrefix")+"/evt?aid="+this.getConfig("accountId")+query;if(typeof mktoTrk!="undefined"&&mktoTrk!=null&&mktoTrk!=""){params+="&ma="+encodeURIComponent(mktoTrk)}this.addDynamicScript(params)};var addDefaultParams=function(){var params="";var vidParam=getVisitorIdParam();params+=(vidParam!="")?("&"+vidParam):"";var vcParam=getVCParam();params+=(vcParam!="")?("&"+vcParam):"";var knownParam=getKnownParam();params+=(knownParam!="")?("&"+knownParam):"";var sidParam=getSessionIdParam();params+=(sidParam!="")?("&"+sidParam):"";var cpvParam=getCPVParam();params+=(cpvParam!="")?("&"+cpvParam):"";var emailParam=getEmailParam();params+=(emailParam!="")?("&"+emailParam):"";var timeZoneOffset=getJodaTimeZone();if(timeZoneOffset){params+=("&ctzo="+timeZoneOffset)}return params};function getJodaTimeZone(){var offset=new Date().getTimezoneOffset(),o=Math.abs(offset);var hourPart=Math.floor(o/60);if((offset<0&&hourPart>14)||(offset>0&&hourPart>12)){return null}return(offset<0?"+":"-")+("00"+Math.floor(o/60)).slice(-2)+":"+("00"+(o%60)).slice(-2)}var getUserContextParams=function(){var userContextParams="";if(window.rtp){userContextParams=rtp.getTracker().get("userContextParams")}return userContextParams};function addToParams(paramsString,paramObj,orginalQueryString){if(paramsString===void 0||paramsString==null){paramsString=""}if(paramObj!==void 0&&paramObj!=null){for(var param in paramObj){if(paramObj.hasOwnProperty(param)){if(paramsString.length>0&&paramsString.lastIndexOf("&")<paramsString.length-1){paramsString+="&"}var exists=orginalQueryString!==undefined?(paramsString.indexOf(param)!=-1||orginalQueryString.indexOf(param)!=-1):paramsString.indexOf(param)!=-1;if(!exists){paramsString+=param+"="+paramObj[param]}}}}return paramsString}function addParams2URI(uri,paramsMap){if(paramsMap!==undefined&&paramsMap!=null){var queryString="",orginalQueryString="";var queryIndex=uri.indexOf("?");var hashIndex=uri.indexOf("#");if(queryIndex>-1){if(hashIndex==-1){hashIndex=uri.length-1}orginalQueryString=uri.substring(queryIndex,hashIndex)}queryString=addToParams(queryString,paramsMap,orginalQueryString);var hashString="";if(hashIndex>-1&&hashIndex!=uri.length-1){hashString=uri.substring(hashIndex);uri=uri.substring(0,hashIndex)}if(queryIndex>-1){if(queryIndex+1<uri.length){uri+="&"}}else{uri+="?"}uri+=queryString+hashString}return uri}function removeURIParam(uri,paramList){var a=document.createElement("a");a.href=uri;var queryStr=a.search;var query="";if(queryStr!=""){var queryStr=queryStr.substring(1,queryStr.length);var queryArr=queryStr.split("&");var queryMap={};var param;for(var i=0;i<queryArr.length;i++){param=queryArr[i].split("=");if(param.length==2){queryMap[param[0]]=param[1]}}for(var i=0;i<paramList.length;i++){delete queryMap[paramList[i]]}for(var key in queryMap){if(queryMap.hasOwnProperty(key)){query+=query.length==0?key+"="+queryMap[key]:"&"+key+"="+queryMap[key]}}}var queryIndex=a.href.indexOf("?");if(queryIndex==-1){queryIndex=a.href.length}uri=a.href.substring(0,queryIndex);if(query!=""){uri+="?"+query}uri+=a.hash;return uri}this.sendClick=function(uri,callback,params2Add,avoidCpv){if(!AITag.getConfig("disableClick")){this.addVisitorId();this.createSessionId(avoidCpv);var referrerExt="";var ref=decodeURIComponent(document.referrer);if(ref!=undefined&&ref!=""){referrerExt="&ref="+encodeURIComponent(ref)}var uriExt="";if(typeof uri!="undefined"&&uri!=""){uriExt="&uri="+uri}var extraParam="";if(typeof params2Add!="undefined"){extraParam="&"+addToParams(extraParam,params2Add)}var searchTerms=this.getSearchTerms();var mktoTrk=this.getCookie(COOKIE_MARKETO_TOKEN);var params=this.getConfig("gwUrlPrefix")+"/trw?aid="+this.getConfig("accountId")+referrerExt+addDefaultParams()+uriExt+extraParam;if(typeof mktoTrk!="undefined"&&mktoTrk!=null&&mktoTrk!=""){params+="&ma="+encodeURIComponent(mktoTrk);mktoExistOnClick=true}if(searchTerms){params+="&"+COOKIE_TRW_SEARCH_TERMS+"="+searchTerms}if(this.getConfig("userContextAPI")){var userContextParams=getUserContextParams();if(userContextParams!==""){params+="&"+userContextParams}}if(AITag.getConfig("viewBlocking")&&potentialCampaignExist){params=addToParams(params,{vb:1});potentialCampaignExist=false}params=addToParams(params,{pm:currentPageAllowedCampaigns.join()});params=addToParams(params,{viewedTypes:encodeURIComponent(viewedTypes.join())});viewTime=new Date().getTime();this.addDynamicScript(params+"&rts="+viewTime,callback);logMessageTime("sending view call. Time since DOM loading: ",new Date().getTime());sendMktoToken.call(this)}};this.cookiesCleanup=function(){if(!config.disableClick){copyVcCookie();copyCpvCookie();try{for(var i=0;i<unusedCookies.length;i++){this.deleteCookie(unusedCookies[i])}}catch(e){}}};this.main=function(){var uri=encodeURIComponent(window.location.href);this.sendClick(uri);this.loadJQuery(AITag.afterFullyLoaded);this.loadCss.apply(this);this.loadState="post-main"};var readyQueue=[];function done(){if(!isReady){var domReadyTime=new Date().getTime();logMessageTime("DOM is ready called. Time since DOM loading: ",domReadyTime,performanceTime&&performanceTime.domContentLoadedEventStart)}isReady=true;if(inzoneCampaignTimeout){clearTimeout(inzoneCampaignTimeout)}if(document.addEventListener||event.type==="load"||document.readyState==="complete"){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",done,false);window.removeEventListener("load",done,false)}else{document.detachEvent("onreadystatechange",done);window.detachEvent("onload",done)}var readyQueueLength=readyQueue.length;while(readyQueueLength){readyQueueLength--;var next=readyQueue.shift();var func=next.shift();if(typeof func==="function"){try{func.apply(AITag,next[0])}catch(e){logMessage("Error:: failed to run ready queue. Error message: "+e)}}}}}function addDOMReadyListener(afterFullyLoaded){var args=[].slice.call(arguments,1);readyQueue.push([afterFullyLoaded,args]);if(document.readyState==="complete"||isReady){afterFullyLoaded.apply(AITag,args)}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",done,false);window.addEventListener("load",done,false)}else{document.attachEvent("onreadystatechange",done);window.attachEvent("onload",done)}}}this.afterExternalJqueryReady=function(afterFullyLoaded){logMessage("after fully loaded: "+afterFullyLoaded);this.afterJQueryLoaded();if(!this.getConfig("useExistingjQueryUI")){if(typeof jQuery.ui!="undefined"&&typeof jQuery.ui.dialog!="undefined"){addDOMReadyListener(afterFullyLoaded)}else{var url=this.getConfig("jqueryUIUrl");if(this.getConfig("loadOnlyJQueryDialog")){url=cdnSrc+this.getConfig("jQueryUIDialogPath")}this.addDynamicScript(url,function(){addDOMReadyListener(afterFullyLoaded)})}}else{var firstInterval=null;var jQueryInterval=setInterval(function(){firstInterval=!firstInterval&&(new Date()).getTime();if((new Date()).getTime()-firstInterval>2000){clearInterval(jQueryInterval)}if(window.$.ui!==void 0||jQuery.ui!==void 0){clearInterval(jQueryInterval);addDOMReadyListener(afterFullyLoaded)}},100)}};this.loadJQuery=function(afterFullyLoaded){var refThis=this;var isJQLoaded=typeof jQuery!="undefined"&&window.jQuery!=null&&jQuery.fn;if(!AITag.getConfig("useExistingJQuery")){function loadJQueryNow(){this.addDynamicScript(this.getConfig("jqueryUrl"),function(){this.afterJQueryLoaded();jQuery.noConflict(true);var url=this.getConfig("jqueryUIUrl");if(this.getConfig("loadOnlyJQueryDialog")){url=cdnSrc+this.getConfig("jQueryUIDialogPath")}this.addDynamicScript(url,function(){addDOMReadyListener(afterFullyLoaded)})})}if(isJQLoaded){if(jQuery.isReady){loadJQueryNow.apply(this)}else{jQuery(document).ready(function(){loadJQueryNow.apply(refThis)})}}else{loadJQueryNow.apply(this)}}else{addDOMReadyListener(this.afterExternalJqueryReady,afterFullyLoaded)}};this.afterJQueryLoaded=function(){this.loadState="loaded jquery";this.jQuery=jQuery};this.getRCMD=function(action){if(this.fullyLoaded){if(checkIESupported()){ibq.push(["init",{link_color:AITag.getConfig("link_color"),font_family:AITag.getConfig("font_family"),font_size:AITag.getConfig("font_size"),font_color:AITag.getConfig("font_color"),background_color:AITag.getConfig("background_color"),bar_position:AITag.getConfig("bar_position"),bar_tab_position:AITag.getConfig("bar_tab_position"),icon_color:AITag.getConfig("barIconColor"),icon_font:AITag.getConfig("barIconFont"),icon_opacity:AITag.getConfig("barIconOpacity")}]);var rcmdHistoryParams=RCMDStorage[getAsParams].call(RCMDStorage);ibq.push(["getREC",getSessionId(),getVisitorId(),getVisitCount(),action,getClickPerVisit(),rcmdHistoryParams,AITag.getCookie(COOKIE_MARKETO_TOKEN)])}}else{rcmdq.push(["getRCMD",action])}};function addSessionCreatedListener(callback){sessionQueue.push(callback)}function runSessionQueue(){var length=sessionQueue.length;var func;for(var i=0;i<length;i++){func=sessionQueue.shift();func.apply(AITag)}}window.rtpRCMD=window.rtpRCMD||function(){(window.rtpRCMD.q=window.rtpRCMD.q||[]).push(arguments)};function initRCMDWidget(){if(sessionReady){var rcmdHistoryParams=RCMDStorage[getAsParams].call(RCMDStorage);window.rtpRCMD("init",{serverUrl:AITag.getConfig("gwUrlPrefix"),sid:getSessionId(),vid:getVisitorId(),vc:getVisitCount(),cc:getClickPerVisit(),consumedAssets:rcmdHistoryParams,munchkinToken:AITag.getCookie(COOKIE_MARKETO_TOKEN)})}else{addSessionCreatedListener(initRCMDWidget)}}this.initRCMDWidget=function(){initRCMDWidget()};function isAnalyticsEnabled(){return AITag.getConfig("googleAnalytics")||AITag.getConfig("enableSiteCatalyst")||AITag.getConfig("enableUAnalytics")||AITag.getConfig("enableFBRemarketing")}function runCampaignQueue(){try{var cpqLength=cpq.length;while(cpqLength){cpqLength--;var param=cpq.shift();var method=param.shift();AITag[method].apply(AITag,param)}cpq.push=function(params){var method=params.shift();AITag[method].apply(AITag,params)}}catch(e){logMessage("Error:: failed to run campaign queue. Error Message: "+e)}}this.afterAllJQueryLoaded=function(){this.fullyLoaded=true;logMessageTime("After All jQuery fully loaded called. Time since DOM loading: ",new Date().getTime());runCampaignQueue();this.checkForEmailTextFields.apply(this);if(this.getConfig("trackAsset")){this.addAssetCollector.apply(AITag)}try{if(isAnalyticsEnabled()){iiq.push(["pushCustomData",getSessionId()]);iiq.push(["pushSegment"])}}catch(e){}if(this.getConfig("enableRecommendationBar")){if(rcmdq.length>0){try{var rcmdLength=rcmdq.length;while(rcmdLength){rcmdLength--;var param=rcmdq.shift();var method=param.shift();AITag[method].apply(AITag,param)}rcmdq.push=function(params){var method=params.shift();AITag[method].apply(AITag,params)}}catch(e){}}else{this.getRCMD.call(this,true)}}};this.afterFullyLoaded=function(){this.loadState="fully loaded";var pollDelay=this.getConfig("pollingDelay")*second;this.pollAmount=this.getConfig("pollingPerPage");if(this.pollAmount>0&&!this.getConfig("disablePoll")&&checkIESupported()){setTimeout(function(){if(AITag.pollInterval==""){AITag.startPoll();if(AITag.pollIntervalCounter<AITag.pollAmount){AITag.pollInterval=window.setInterval(AITag.startPoll,pollDelay)}}},this.getConfig("initialDelay"))}if(typeof this.loadCallBack==="function"){this.loadCallBack()}this.afterAllJQueryLoaded.apply(this)};this.startPoll=function(){AITag.loadState="polling";AITag.pollMsg();if(AITag.pollIntervalCounter>=AITag.pollAmount){clearInterval(AITag.pollInterval);AITag.pollInterval=""}};this.go=function(callback){if(AITag.loadState=="post-startup"){AITag.loadCallBack=callback;AITag.main.apply(AITag)}else{throw"AI logic failed to continue. Load State is "+AITag.state}};function isCampaignURLEmpty(){return campaignUrlData===""||campaignUrlData===""}function getURLMatchData(key){return key.split("%rtp%")}var notAllowed=["widget"],ZONE_IDS_KEY="zoneIds",CAMPAIGN_IDS_KEY="campaignIds";this.populatePageCampaignData=function(){var currentPageZones=[];if(!isCampaignURLEmpty()){var matchData,isMatch;var currentURL=getCurrentUrlAsArray();for(var key in campaignUrlData){matchData=getURLMatchData(key);if(matchData.length>1){isMatch=isURLMatch(currentURL,matchData[0],matchData[1]);if(!containsWildcard(matchData[0])&&isMatch){currentPageZones=concatArray(currentPageZones,campaignUrlData[key][ZONE_IDS_KEY],notAllowed);currentPageAllowedCampaigns=concatArray(currentPageAllowedCampaigns,campaignUrlData[key][CAMPAIGN_IDS_KEY])}else{if(isMatch){currentPageAllowedZones=concatArray(currentPageAllowedZones,campaignUrlData[key][ZONE_IDS_KEY],notAllowed);currentPageAllowedCampaigns=concatArray(currentPageAllowedCampaigns,campaignUrlData[key][CAMPAIGN_IDS_KEY])}}}else{currentPageAllowedZones=concatArray(currentPageAllowedZones,campaignUrlData[key][ZONE_IDS_KEY],notAllowed);allPagesAllowedCampaigs=concatArray(allPagesAllowedCampaigs,campaignUrlData[key][CAMPAIGN_IDS_KEY])}}}potentialCampaignExist=currentPageZones.length>0;currentPageAllowedZones=concatArray(currentPageAllowedZones,currentPageZones,notAllowed);return currentPageAllowedZones.length>0};this.hideInzoneElements=function(){if(AITag.getConfig("inZoneBlockingTimeout")!=0&&!isCampaignURLEmpty()){logMessage("hidden elmenets, setting timeout to: "+AITag.getConfig("inZoneBlockingTimeout"));var index;var css="";for(index=0;index<currentPageAllowedZones.length;++index){if(index<currentPageAllowedZones.length-1){css+="#"+currentPageAllowedZones[index]+","}else{css+="#"+currentPageAllowedZones[index]}}css+=" { visibility: hidden; }";var head=document.head||document.getElementsByTagName("head")[0];var style=document.createElement("style");style.type="text/css";style.id="rtpInzoneIdsStyle";if(style.styleSheet){style.styleSheet.cssText=css}else{style.appendChild(document.createTextNode(css))}head.appendChild(style);AITag.showInzoneElementsTimeOut=setTimeout(function(){AITag.showInzoneElements(true)},AITag.getConfig("inZoneBlockingTimeout"))}};this.showInzoneElements=function(forceShow){if(AITag.getConfig("inZoneBlockingTimeout")!=0&&!isCampaignURLEmpty()){var style=document.getElementById("rtpInzoneIdsStyle");if(style!=null&&typeof style!="undefined"){var hiddenExists=false;if(!forceShow){for(var index=0;index<currentPageAllowedZones.length;++index){if(document.getElementById(currentPageAllowedZones[index])){hiddenExists=true}}}if(forceShow||hiddenExists){logMessageTime("showing hidden elements. Show by timeout: "+forceShow+". Time: ",new Date().getTime());hiddenElementsShown=true;var version=getInternetExplorerVersion();if(version>-1&&version<11){var cssText=style.styleSheet.cssText;cssText=cssText.replace(/hidden/g,"visible");style.styleSheet.cssText=cssText}else{var cssText=style.innerHTML;cssText=cssText.replace("hidden","visible");style.innerHTML=cssText}if(AITag.showInzoneElementsTimeOut){clearTimeout(AITag.showInzoneElementsTimeOut)}}}}}};window.AITag=AITag;var inzoneExist=AITag.populatePageCampaignData();if(inzoneExist){AITag.hideInzoneElements()}try{var isDebugCookieVal=AITag.getCookie("db_rtp");if(isDebugCookieVal){isDebug=(isDebugCookieVal==="true")}}catch(e){}if(window.rtp){var aid=window.rtp&&window.rtp.a;if(aid!==undefined&&aid!=null){AITag.setConfig("accountId",aid)}}if(window.self!==window.top){if(location&&location!==top.location){AITag.disableTag(true)}}try{var pollCampaign=AITag.extractURLParameter("pollCampaign");var previewUUID=AITag.extractURLParameter("rtp.cuid");if(pollCampaign!=null){AITag.previewCallback(pollCampaign,null,true)}else{if(previewUUID!=null){AITag.disableTag();AITag.updateInitialConfig.apply(AITag)}}}catch(e){}try{window.aiq=window.aiq||[];if(window.aiq){var aiqLength=aiq.length;while(aiqLength){aiqLength--;var param=aiq.shift();var method=param.shift();AITag[method].apply(AITag,param)}aiq.push=function(params){var method=params.shift();AITag[method].apply(AITag,params)}}}catch(e){}try{window.AIConfig=window.AIConfig||{};var startup=(typeof AITag.getConfig("startup")!="undefined"&&AITag.getConfig("startup")!=null)?AITag.getConfig("startup"):true;var isExcludeUrl=AITag.checkExcludeUrls.apply(AITag);if(isExcludeUrl){AITag.disableTag()}var rtpExists=(window.rtp&&window.rtp.a);if(!rtpExists&&startup&&!isExcludeUrl){AITag.cookiesCleanup.apply(AITag);AITag.startup.apply(AITag)}}catch(e){console.log("tag error: "+e)}})();(function(N){var Q="widget",I="tab",j="content",c="insightera_widget_button",s="insightera_widget_container",m="insightera_widget_content",f="insightera-widget",w="insightera-widget-",H="insightera-widget-tab",n="insightera-widget-content",B="widget-1.1.css",p="http://rtp-static.marketo.com/rtp/libs",t="https://rtp-static.marketo.com/rtp/libs",d="/black_01.png",K="/black_02.png",a={widgetFontColor:"color",widgetPositionTop:"top",widgetHide:"display",tabColor:"backgroundColor",tabOpacity:"opacity",contentColor:"backgroundColor",contentOpacity:"opacity",contentMinHeight:"min-height",contentPadding:"padding"},J=["widgetTabTooltip","widgetTabText","widgetHide","widgetTabImage","tabHeight","tabWidth"],F=null,q=(("https:"==document.location.protocol)?"https":"http"),b=((q=="http")?p:t),k={widgetFontColor:"white",widgetPositionTop:"50%",widgetPositionSide:"right",widgetHide:false},v={tabColor:"rgba(0,0,0,0.6)",tabImageClosed:b+d,tabImageOpened:b+K,tabTooltip:"",tabHeight:"59px",tabWidth:" 35px"},u={contentColor:"rgba(0,0,0,0.6)",contentMinHeight:"55px",contentPadding:"0.2em"},S=null,o=null,h=null,E=function(){var U=document.createElement("div");U.style.cssText="background-color:rgba(150,255,150,.5)";if(!!~(""+U.style.backgroundColor).indexOf("rgba")){return true}return false},C=function(U){if(U&&U.indexOf("http")==-1&&U.indexOf("https")==-1){U=q+"//"+U}return U},T=function(V){var X;var U="",Y="";var W=0;if(V.indexOf("rgba")==-1){X=V.replace("rgb(","").replace(")","").replace(" ","").split(",")}else{X=V.replace("rgba(","").replace(")","").replace(" ","").split(",")}if(X.length==3){U+="#ff"}else{U+=Math.floor(X[3]*255).toString(16);if(U.length==1){U="#0"+U}else{U="#"+U}}while(W<3){Y=(X[W]*1).toString(16);Y=Y.length==1?"0"+Y:Y;U+=Y;W++}return U},D=function(W,V,U){if(V.addEventListener){V.addEventListener(W,U,true)}else{if(V.attachEvent){V.attachEvent("on"+W,U)}else{V[W]=U}}},g=function(W,U,V){if(W.removeEventListener){W.removeEventListener(U,V,false)}if(W.detachEvent){W.detachEvent("on"+U,V)}},R=function(U){return{width:U.offsetWidth,height:U.offsetHeight}},y=function(W){var U=document.getElementsByTagName("head")[0];var V=document.createElement("link");if(W.indexOf("http")==-1&&W.indexOf("https")==-1){W=q+"://"+W}V.type="text/css";V.href=W;V.rel="stylesheet";U.appendChild(V)},l=function(){if(AITag.jQuery){F=AITag.jQuery}},A=function(){y(b+"/"+B)},G=function(){if(!S){S=document.createElement("div");S.setAttribute("id",c);S.setAttribute("class",f+" "+H+" "+w+k.widgetPositionSide);S.style.display="none";document.body.appendChild(S);D("click",S,function(){if(h.style.display=="none"){L()}else{P()}})}if(!o){o=document.createElement("div");o.setAttribute("id",m);o.setAttribute("class",n);h=document.createElement("div");h.setAttribute("id",s);h.setAttribute("class",f+" "+w+k.widgetPositionSide);h.appendChild(o);h.style.display="none";document.body.appendChild(h)}},r=function(U){for(property in U){if(U.hasOwnProperty(property)){if(property=="tabImageClosed"||property=="tabImageOpened"){v[property]=C(U[property])}else{if(U[property]!=null&&typeof U[property]!="undefined"){if(k.hasOwnProperty(property)){k[property]=U[property]}else{if(v.hasOwnProperty(property)){v[property]=U[property]}else{if(u.hasOwnProperty(property)){u[property]=U[property]}}}}}}}},x=function(){for(var W in k){if(k.hasOwnProperty(W)){if(J.indexOf(W)==-1){S.style[a[W]]=k[W];h.style[a[W]]=k[W]}}}for(var W in v){if(v.hasOwnProperty(W)){if(J.indexOf(W)==-1){if(W=="tabColor"&&v[W].indexOf("rgba")!=-1&&!E()){continue}S.style[a[W]]=v[W]}}}if(v.tabColor.indexOf("rgba")!=-1&&!E()){var U=T(v.tabColor);S.style.filter="progid:DXImageTransform.Microsoft.gradient(startColorstr="+U+", endColorstr="+U+")"}for(var W in u){if(u.hasOwnProperty(W)&&J.indexOf(W)==-1){if(W=="contentColor"&&u[W].indexOf("rgba")!=-1&&!E()){continue}h.style[a[W]]=u[W]}}if(u.contentColor.indexOf("rgba")!=-1&&!E()){var U=T(u.contentColor);h.style.filter="progid:DXImageTransform.Microsoft.gradient(startColorstr="+U+", endColorstr="+U+")"}S.setAttribute("title",v.tabTooltip);if(!k.widgetHide){S.style.display="block"}if(v.tabImageClosed==""||v.tabImageClosed===undefined){S.style.height=v.tabHeight;S.style.width=v.tabWidth}else{var X,V;if(k.widgetPositionSide=="right"){X=v.tabImageClosed;V=v.tabImageOpened}else{X=v.tabImageOpened;V=v.tabImageClosed}S.innerHTML+='<img src="'+X+'" id="tabImageClosed"/>';if(typeof v.tabImageOpened!="undefined"){S.innerHTML+='<img src="'+V+'" id="tabImageOpened" style="display:none;"/>'}}},e=function(U){A();r(U);G();x()},L=function(){if(F==null){l()}if(o.childElementCount==0){return}var W=R(S);if(W.width==0){setTimeout(function(){W=R(S);if(W.width==0){h.style[k.widgetPositionSide]=v.tabWidth}else{h.style[k.widgetPositionSide]=W.width+"px"}if(F){F("#insightera_widget_container").show(500)}else{h.style.display="block"}},200)}else{h.style[k.widgetPositionSide]=W.width+"px";if(F){F("#insightera_widget_container").show(500)}else{h.style.display="block"}}var U=document.getElementById("tabImageOpened");if(typeof U!="undefined"){var V=document.getElementById("tabImageClosed");U.style.display="block";V.style.display="none"}},P=function(){if(F){F("#insightera_widget_container").hide(500)}else{h.style.display="none"}var U=document.getElementById("tabImageOpened");if(typeof U!="undefined"){var V=document.getElementById("tabImageClosed");U.style.display="none";V.style.display="block"}},z=function(U){o.innerHTML=U},M=function(U){try{return U()}catch(V){if(N.console&&N.console.log){N.console.log("widget Error: ",V)}}},O=function(){var U=document.getElementsByTagName("body")[0];if(S&&U){U.removeChild(S);S=null}if(h&&U){U.removeChild(h);h=null;o=null}},i={init:function(U){M(function(){e(U)})},injectContent:function(U){M(function(){z(U)})},show:function(){M(function(){L()})},getContentId:function(){return m},isInitilized:function(){if(S&&o&&h){return true}return false},destroy:function(){M(function(){O()})}};if(N.InsighteraWidget===undefined){N.InsighteraWidget=i}})(window);
if(!Object.keys){Object.keys=(function(){var c=Object.prototype.hasOwnProperty,d=!({toString:null}).propertyIsEnumerable("toString"),b=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],a=b.length;return function(g){if(typeof g!=="object"&&(typeof g!=="function"||g===null)){throw new TypeError("Object.keys called on non-object")}var e=[],h,f;for(h in g){if(c.call(g,h)){e.push(h)}}if(d){for(f=0;f<a;f++){if(c.call(g,b[f])){e.push(b[f])}}}return e}}())}(function(){var i=window,y=i.document,ae=i.encodeURIComponent,bL=i.decodeURIComponent;setTimeoutFunction=i.setTimeout;parseInt=i.parseInt;var aV="send",bn="get",a6="set",br="add",bD="setAccount",l="getTracker",e="checkPattern",m="campaign",aL="rcmd",ce="view",al="event",P="visitor",ap="redirect",a="ucontext",j="customVar",X="toCmpTl",am="userContextParams",G="userContextReady",N=new RegExp("^"+j+"([1-5]{1})$"),ci=[aV,bn,a6,br],a3=[ce,al,m,P,aL,ap,a,X,am],T=[bD,l],bw=[G],aR=[ce,al,m,aL],p=false,n="rtp",b8="trackerData",bu="trackers",Q="aid",a2="name",bE="userContext",c="length",b0="shift",M="apply",bZ="push",cB="location",cb="href",ah="indexOf",H="protocol",bv="slice",bX="call",cv="object",z="prototype",cu="hasOwnProperty",R="function",bK="hostname",bl="match",ao="createElement",k="unshift",aD="toLowerCase",bY="getElementsByTagName",f="splice",a4="split",v="substring";var d="?",x="=",b7="&",bU="http",aM="https",aQ=((aM+":"==y[cB][H])?aM:bU);aQ=aQ+"://",exp_2_year=new Date();exp_2_year.setTime(exp_2_year.getTime()+(730*24*60*60*1000));var cz="rtp",cn="aiq";var bi=i.AITag,ax="setConfig",aS="getConfig",bT="startup",ca="updateInitialConfig",aJ="sendClick",u="accountId",by="pollMsg",A="sendEvent",ct="addAssetCollector",bO="activateRecommendation",t="runAnalyticsIntegration",bA="loadCss",aF="runAsyncQueue",be="afterAllJQueryLoaded",L="getRCMD",cw="rh",cd="loadJQuery",bt="cookiesCleanup",bS="trwsa.sid",ac="trwv.uid",ab="requestInterval",av="isNewVisitor",bj="addVisitorId",b5="userContextAPI",h="pollingDelay",bq="pollingPerPage",bW="activateCampaignStorage",b=(bi&&bi[aS](ab)!=null)?bi[aS](ab):50,F=(bi&&bi[av]())?true:false,cp=(bi&&bi[aS](b5))?true:false,bP=true,C=1,aT=null,aP=(bi&&bi[aS](bq)!=null)?bi[aS](bq):1,bo=(bi&&bi[aS](h)!=null)?(bi[aS](h)*1000):50,J=[];var aX="sjrtp7.marketo.com/gw1",aC=null,aI="/rtp/api/v1_1/",a1="visitor",a5="sid",g="aid";var cf=null,S=null,bc=null,aU=false,bd=[],bh=false,at=false,b9=(i[cz]&&i[cz].hb)?i[cz].hb:false,bG=false;var aB=i.IeraPreview&&i.IeraPreview.previewShowed;var aE=i.ITLocalStorageAPI;p=i[cz]&&i[cz].d;var ad=i[cn]=i[cn]||[];if(F&&!aB){bi&&bi[bj]}if(!aB){ad[bZ]([ca]);ad[bZ]([cd,function(){ad[bZ]([be])}]);ad[bZ]([bA])}if(!o()&&!aB){ad[bZ]([bW]);i.rtpRCMD=i.rtpRCMD||function(){(i.rtpRCMD.q=i.rtpRCMD.q||[]).push(arguments)};ad[bZ](["initRCMDWidget"])}function bQ(cD,cC,cE){cD[cC]=function(){return cE[M](this,arguments)}}function o(){return p}function aH(){return(new Date).getTime()}function ak(cC){if(window.console&&window.console.log){console.log("RTP message: "+cC)}}function bJ(){var cC=Array[z][bv][bX](arguments);for(var cD=0;cD<cC[c];cD++){if(cC[cD]===undefined||cC[cD]==null||cC[cD]===""){return true}}return false}function b1(cD){var cC=parseInt(cD);if(!isNaN(cC)){return cC}return null}function cy(cC){return Object[z].toString[bX](cC)==="[object Object]"}function q(cC){return typeof cC==="function"}function I(cF,cC){var cE=new XMLHttpRequest();if("withCredentials" in cE){try{cE.open(cF,cC,true)}catch(cD){ak(cD)}}else{if(typeof XDomainRequest!="undefined"){cE=new XDomainRequest();cE.open(cF,cC)}else{cE=null}}return cE}function bk(cC,cD){if(cC===undefined||cC==null||cC==""){return}if(cC[ah](bU)!=0&&cC[ah](aM)!=0){cC=aQ+cC}cC+="&"+aH();var cE=I("GET",cC);if(!cE){ak("CORS not supported");return}cE.onload=function(){var cG=cE.responseText;var cF=JSON.parse(cG);if(cF.status==200){if(typeof cD==R){cD(cF)}}else{ak(cF.errorMessage)}};cE.onerror=function(){};cE.send()}function W(cE){var cD=y[bY]("head")[0]||y.documentElement;var cC=y[ao]("script");cC.type="text/javascript";cC.async=true;if(cE[ah](bU)!=0&&cE[ah](aM)!=0){cE=aQ+cE}cC.src=cE;cD.insertBefore(cC,cD.firstChild)}function D(cC,cE){for(var cD in cE){if(cE[cu](cD)){if(cC==""||cC==d){cC+=cD+"="+ae(cE[cD])}else{cC+="&"+cD+"="+ae(cE[cD])}}}return cC}function bM(cC,cG){if(cC&&cG){var cE=i[cB]["search"];var cF="";if(cC[ah](d)==-1){cF+=d}cF=D(cF,cG);if(cF!=""&&cF!=d){if(cC[ah]("#")>-1){var cD=cC[v](0,cC[ah]("#"));if(cE&&cE.length>0){cD+="&"}cD+=cF;cD+=cC[v](cC[ah]("#"),cC[c]);cC=cD}else{if(cE&&cE.length>0){cC+="&"}cC+=cF}}}return cC}function cx(cE,cC){if(cC&&cC===parseInt(cC)){for(var cD=cE[a4](".");cD.length>cC&&cD.length>2;){cD.shift()}return cD.join(".")}cD=/([^.]+\.[^.]{3,})$/i.exec(cE);return cD!=null?cD[1]:(cD=/([^.]+\.[^.]+\.[^.]{2})$/i.exec(cE),cD!=null?cD[1]:cE)}function O(){return"xxxxxxxx".replace(/[x]/g,function(cD){var cC=Math.random()*16|0;return cC.toString(16)})}function E(){var cC=aC;if(cC){cC=cC.replace(".","-")}return cC+"-"+aH()+"-"+O()}function cq(cD){var cC=b2.getValue(cD);if(cC!=null){cC=cC[a4](b2.seperator)}return cC}function cj(){var cD=null;var cC=cq(bS);if(cC!=null&&cC.length>0){cD=cC[0]}return cD}function aN(){var cC=cq(ac);if(cC==null){newVisitor=true;visitorId=E();var cD=visitorId+b2.seperator+"0";b2.store(ac,cD,exp_2_year)}}function aW(){var cD=null;var cC=cq(ac);if(cC!=null&&cC.length>0){cD=cC[0]}return cD}var b2=new function(){this.seperator=":";this.store=function(cD,cF,cC,cH,cG){var cE=cx(i[cB][bK],void 0);if(cE=="localhost"){cE=null}y.cookie=cD+"="+ae(cF)+((cC==null)?"":("; expires="+cC.toGMTString()))+"; path="+((cH==null)?"/":cH)+((cE==null)?"":("; domain="+cE))+((cG==true)?"; secure":"")};this.remove=function(cC,cF,cD,cE){var cH=new Date();cH.setTime(cH.getTime()-1);var cG=this.getValue(cC);this.store(cC,cG,cH,cF,cE)};this.getValue=function(cE){var cD=null,cF=y.cookie[a4](";");var cH=RegExp("^\\s*"+cE+"=\\s*(.*?)\\s*$");for(var cC=0;cC<cF.length;cC++){var cG=cF[cC][bl](cH);if(cG&&cG[1]){cD=bL(cG[1]);break}}return cD}};function a8(cD){var cC=y[ao]("a");cC[cb]=cD;cD=cC[cb];return cD}function bf(cC){bh=true;if(cC[ah](bU)!=0&&cC[ah](aM)!=0){cC=aQ+cC}i[cB]=cC}function co(cC){if(cC!==void 0){for(var cD=0;cD<cC[c];cD++){if(typeof cC[cD]==="string"){cC[cD]=cC[cD][aD]()}}}return cC}var B="rtpUC",bR="vid",aK="cv",bC="ct",ck="vc",s=0,bB=6,cs=10,bI=10,w=100,V=1000,bg=new RegExp("^"+aK+"([1-5]{1})$"),aZ=0,bz=1,a0="viewedCampaigns",bm="clickedCampaigns";var cm="ctv",b6="ctc";var r="getUserContext",aA="storeUserContext",af="storeCustomVar",bV="storeCampaing",a9="validateVisitCount",aG="validateCampaignId",ay="validateCampaigntype",K="addVisitorId",bN="getUserContexParams",cc="getCampaignVisit";var Z={};function aj(){return cp}Z[r]=function(){if(aE.supports()&&aj()){var cD=aE.getValue(B);if(cD!==void 0){cD=JSON.parse(cD);var cC=aW();if(cD[bR]){if(cD[bR]===cC){return cD}}}cD={};return this[K](cD)}return null};Z[aA]=function(){if(aE.supports()&&arguments[c]>0&&aj()){var cC=arguments[0];if(cC!==undefined&&cC!==null&&cy(cC)){cC=JSON.stringify(cC);aE.store(B,cC)}}};Z[K]=function(cD){if(!cD[bR]){var cC=aW();if(cC===void 0||cC==null){aN()}cD[bR]=aW()}return cD};Z[af]=function(cC,cD){if(aE.supports()&&aj()){cC=b1(cC);if(!bJ(cC,cD)&&cC>s&&cC<bB&&cD.length<w){var cE=this[r]();if(cE!==null&&cy(cE)){cE[aK+cC]=cD;this[aA](cE)}}}};Z[bV]=function(cD,cC,cE){if(aE.supports()&&aj()){if(!bJ(cD,cC,cE)){cD=b1(cD);cC=b1(cC);cE=b1(cE);if(this[a9](cD)&&this[aG](cC)&&this[ay](cE)){var cI=this[r]();if(cI!==null&&cy(cI)){var cH={};cH[cC]=cE;if(!cI[bC]){cI[bC]={}}var cG=this[cc](cI,cD);for(var cF=0;cF<cG[c];cF++){if(!bJ(cG[cF][cC])&&cG[cF][cC]==cE){return}}if(cG[c]>=bI){cG[b0]()}cG[bZ](cH);cI[bC][ck+cD]=cG;this[aA](cI)}}}}};Z[cc]=function(cF,cC){var cD=cF[bC][ck+cC];if(bJ(cD)){cD=[];var cE=Object.keys(cF[bC]);if(cE.length>=cs){delete cF[bC][cE[0]]}}return cD};Z[a9]=function(cC){if(cC>0&&cC<V){return true}return false};Z[aG]=function(cC){if(cC>0){return true}return false};Z[ay]=function(cC){if(cC==0||cC==1){return true}return false};Z[bN]=function(){var cC="",cD;var cE=this[r]();cD=au(cE);cC=D(cC,cD);return cC};function au(cH){var cC,cF={},cD;if(!bJ(cH)&&cy(cH)&&aj()){var cE=aW();if(cH[bR]&&cH[bR]==cE){for(var cG in cH){if(cH[cu](cG)){cC=bg.exec(cG);if(cC){cF[cG]=cH[cG]}else{if(cG==bC){cD=cH[cG];cF=aO(cD,cF)}}}}}}return cF}function aq(cE,cI){var cC,cG={},cD;if(aj()&&!bJ(cI)&&cy(cI)){var cF=aW();if(cI[bR]&&cI[bR]==cF){for(var cH in cI){if(cI[cu](cH)){cC=bg.exec(cH);if(cC){cE[j+cC[1]]=cI[cH]}else{if(cH==bC){cD=cI[cH];cG=aO(cD,cG);if(cG[cm]){cE[a0]=cG[cm][a4](",")}if(cG[b6]){cE[bm]=cG[b6][a4](",")}}}}}}}cE.viewedCampaign=U;cE.clickedCampaign=aw}function U(cD){if(bJ(cD)){return false}if(!(cD instanceof Array)){cD=[cD]}var cC=b3[bE][a0];if(bJ(cC)){return false}for(var cE=0;cE<cD[c];cE++){if(cC[ah](cD[cE].toString())>-1){return true}}return false}function aw(cC){if(bJ(cC)){return false}if(!(cC instanceof Array)){cC=[cC]}var cD=b3[bE][bm];if(bJ(cD)){return false}for(var cE=0;cE<cC[c];cE++){if(cD[ah](cC[cE].toString())>-1){return true}}return false}function aO(cE,cC){var cK,cD,cF=[],cH=[];for(var cJ in cE){if(cE[cu](cJ)){cJ=cE[cJ];for(var cG=0;cG<cJ[c];cG++){cD=cJ[cG];for(var cI in cD){if(cD[cu](cI)){if(cD[cI]==aZ&&cF[ah](cI)==-1){cF[bZ](cI)}else{if(cD[cI]==bz&&cH[ah](cI)==-1){cH[bZ](cI)}}}}}}}if(cF[c]>0){cC[cm]=cF.join()}if(cH[c]>0){cC[b6]=cH.join()}return cC}var ag=5,cr="addTrigger",ba="trigger";var cl=[],ai={};var cA={};cA[cr]=function(cD,cE){if(q(cE)){if(cl[ah](cD)>-1&&cE){return cE[M]()}else{var cC=ai[cD];if(!b4(cC)){cC=[]}if(cC[c]<ag){cC[bZ](cE)}ai[cD]=cC}}};cA[ba]=function(cD){if(cl[ah](cD)==-1){cl[bZ](cD);var cC=ai[cD];if(b4(cC)){for(var cE=0;cE<cC[c];cE++){try{cC[cE][M]()}catch(cF){}}}}};var an={};an.callMethod=function(){var cE;for(var cD=0;cD<arguments[c];cD++){cE=arguments[cD];var cG=cE[0];if(T[ah](cG)>-1){this.applyRtp(b3,cG,cE)}else{if(ci[ah](cG)>-1){var cF=b3.getTracker(n);this.applyRtp(cF,cG,cE)}else{if(bw[ah](cG)>-1){var cC=[][bv][bX](cE,0);cC[k]("");this.applyRtp(cA,cr,cC)}}}}};an.applyRtp=function(cD,cE,cC){cC=[][bv][bX](cC,1);return cD[cE][M](cD,cC)};var aY={};aY[ce]=function(){var cC=i[cB][cb];if(arguments[c]>0){var cD=arguments[0];if(typeof cD==cv){cC=bM(cC,cD)}else{if(typeof cD=="string"){cC=a8(cD)}}}cC=ae(cC);cf=aH();ad[bZ]([aJ,cC,bx])};aY[al]=function(){if(arguments[c]>0){var cE=arguments[0];if(typeof cE==cv&&JSON.stringify(cE).length<255){var cD=0;for(var cF in cE){if(cE[cu](cF)){cD++}}if(cD<5){var cC=cf?aH()-cf:null;if(cf&&cC&&cC<b){setTimeoutFunction(function(){S=aH();rtp(aV,al,cE)},(b-cC))}else{S=aH();ad[bZ]([A,cE])}}}}};aY[m]=function(){if(arguments[c]>0){bG=true;var cE=void 0,cD=void 0;var cC=arguments[0];typeof cC=="boolean"?cD=cC:((typeof cC==R)?cE=cC:void 0);if(cE){aa(cE,cD)}else{if(cD){aa(cE,cD)}}}};aY[P]=function(){if(arguments[c]>0){var cG=arguments[0];if(typeof cG==R){var cD=aQ+aX+aI+a1;var cC=aH(),cE=cf?cC-cf:null,cF=S?cC-S:null;if((cE&&cE<b)||(cF&&cF<b)){setTimeoutFunction(function(){rtp(bn,P,cG)},b)}else{bH(cD,cG)}}}};aY[aL]=function(){var cG=null;if(arguments[c]>0){var cC=arguments[0],cE=void 0,cD=void 0;if(arguments.length>1){cE=arguments[1];cD=arguments[2]}var cF=aH()-cf;if(cf&&cF<b){setTimeoutFunction(function(){if(cE){rtp(bn,aL,cC,cE,cD)}else{rtp(bn,aL,cC)}},cF)}else{if(typeof cC==="boolean"||typeof cC==="function"){ad[bZ]([L,cC])}else{switch(cC){case"richmedia":if(arguments.length>1){i.rtpRCMD("change",arguments[1],arguments[2])}else{i.rtpRCMD("get")}break;default:throw cC+" isn't defined"}}}}};aY[ap]=function(){try{if(arguments[c]>2){var cI=arguments[0],cC=arguments[1],cF=arguments[2],cE=false;var cH=i[cB][cb];var cD=cH[ah](cF);if(cD!=-1&&cD<8){return}if(arguments[c]>3){cE=arguments[3]}if(b9&&!at){bb()}if(aU){if(bc==null){bd[bZ]([cI,cC,cF,cE])}else{Y(bc,cI,cC,cF,cE)}}else{aU=true;bd[bZ]([cI,cC,cF,cE]);aY[P](ar)}if(b9){bF()}}}catch(cG){}};aY[a]=function(){if(arguments[c]>0){var cC=arguments[0];var cD=Z[r]();aq(cC,cD);b3[bE]=cC;cA[ba](G)}};aY[j]=function(){Z[af][M](Z,arguments)};aY[X]=function(){Z[bV][M](Z,arguments)};aY[am]=function(){return Z[bN][M](Z)};function bx(){if(bG){ad[bZ]([aF])}ad[bZ]([by])}function Y(cH,cL,cK,cC,cD){if(bh){return}if(cL!==void 0&&cK!==void 0&&cC!==void 0){var cI=cL[a4](".");var cE=null;cH=cH[cI[0]];if(cI[c]>1){cE=cI[1]}cK=co(cK);if(!(cH instanceof Array)){cH=[cH]}var cJ;var cG=-1;for(var cF=0;cF<cH[c];cF++){if(Object[z].toString[bX](cH[cF])==="[object Object]"){if(cH[cF][cu](cE)){cJ=cH[cF][cE]}else{ak("can't match against uknown value");break}}else{cJ=cH[cF]}if(typeof cJ==="string"){cJ=cJ[aD]()}if(cK[ah](cJ)>-1){cG=cF;if(!cD){break}}}if(!cD&&cG>-1){bf(cC)}else{if(cD&&cG==-1){bf(cC)}}}}function ar(cC){if(cC.status==200){bc=cC.results;while(bd.length){var cD=bd[b0]();cD[k](bc);Y.apply(this,cD)}}}function bb(){var cD="body { display: none; }",cC=y.head||y[bY]("head")[0]||y.documentElement,cE=y[ao]("style");cE.type="text/css";if(cE.styleSheet){cE.styleSheet.cssText=cD}else{cE.appendChild(y.createTextNode(cD))}cC.appendChild(cE)}function bF(){setTimeout(function(){if(y[bY]("body")[0]!==undefined){y[bY]("body")[0].style.display="inline"}else{y.addEventListener("DOMContentLoaded",function(){y[bY]("body")[0].style.display="inline"},false)}},1000)}function bH(cD,cF){if(cD&&aC!=null){if(typeof cF==R){var cC=cj();var cE=d;if(cC){cE+=a5+x+cC+b7}cE+=g+x+aC;bk(cD+cE,cF)}}}function aa(cE,cD){var cC=aH();if((cf&&(cC-cf)<b)||(S&&(cC-S)<b)){setTimeoutFunction(function(){aa(cE,cD)},b)}else{if(bP){bP=false;J.push([cE,cD]);aT=setInterval(bp,bo)}ad[bZ]([by,cE,cD])}}function bp(){C++;if(C>aP){if(aT){clearInterval(aT)}return}var cC=J.shift();J.push(cC);aa(cC)}var cg=function(cD,cC){this[b8]={};if(!cC||cC==""){cC=n}this[b8][a2]=cC;this[b8][Q]=cD};var bs=function(){if(arguments[c]>0){var cC=arguments[0];if(a3[ah](cC)>-1){if(o()&&aR[ah](cC)>-1){return}return an.applyRtp(aY,cC,arguments)}}};cg[z].get=bs;cg[z].send=bs;cg[z].set=function(){if(arguments[c]>0){var cE=arguments[0];var cC=N.exec(cE);if(cC!==null){var cD=[][bv][bX](arguments,0);cD[f](1,0,cC[1]);return an.applyRtp(aY,j,cD)}else{if(a3[ah](cE)>-1){if(o()&&aR[ah](cE)>-1){return}return an.applyRtp(aY,cE,arguments)}}}};cg[z].add=bs;var b3=function(){return an.callMethod[M](an,[arguments])};b3[bD]=function(){var cE=arguments[0];if(b4(cE)){var cD=n;if(arguments[c]>1){cD=arguments[1]}if(this[bu][cD]){return this[bu][cD]}var cC=new cg(cE,cD);ch(cC);ad[bZ]([ax,u,cE]);return cC}};b3[l]=function(){var cC=(arguments[c]>0&&arguments[0]&&arguments[0]!="")?arguments[0]:n;return b3[bu][cC]};b3[bu]={};bQ(b3,l,b3[l]);bQ(b3,e,InsighteraUtil.checkPattern);function ch(cC){if(!b3[bu][cC[b8][a2]]){b3[bu][cC[b8][a2]]=cC}}function a7(){ak("campaign callback called")}function b4(cC){return void 0!==cC&&cC!=null&&cC!==""}if(!aB&&i[cz]){var az=i[cz]&&(i[cz].q||[]);aC=i[cz]&&i[cz].a;if(aC){b3[bD](aC)}i[cz]=b3;an.callMethod[M](an,az)}if(!o()&&!aB){ad[bZ]([ax,bT,false]);ad[bZ]([bO]);ad[bZ]([t]);ad[bZ]([bt])}})();(function(){var X=window,ai=false,H=false;try{var d=AITag.getCookie("db_rtp");if(d){H=(d==="true")}}catch(Q){}var aH="length",aL="apply",M="querySelectorAll",r="call",n="slice",Y="prototype",az="change",ac="init",aD="get";var G=null,al=null,A=null,an=null,k=null,p=null,x=null,ag=null;var ar="rtp";var g="/rtp/api/v1_2",at=g+"/rcmd/richmedia/trending.json";var l="thumbnail",aG="assetId",h="url",am="ctaText",B="header",J="description";var av="html",aw="data",V="settings",aI="containerSelector",s="data-widget-rtp-id";var aj="data-rtp-id";var S="//rtp-static.marketo.com/rtp/rcmd/template/";var f=[],I=[],aA=[];function j(aM){try{if(H&&window.console&&window.console.log){console.log(aM)}}catch(aN){}}function ae(e){return e!==undefined&&e!=null}function P(e){return ae(e)&&e!=""}function b(e){return ae(e)&&Object.prototype.toString.call(e)==="[object Array]"}function C(e){return b(e)&&e.length==0}function D(e){return ae(e)&&typeof e=="object"}function N(e,aM){return e.hasOwnProperty(aM)}function F(e){return L(document,e)}function L(aM,e){if(P(e)){return aM[M](e)}throw"can't find elements for empty selector"}function af(){return"xxxxxxxx".replace(/[x]/g,function(aM){var e=Math.random()*16|0;return e.toString(16)})}function E(aO,aM,e){if(aO===void 0||aO==null){aO=""}if(aM!==void 0&&aM!=null){for(var aP in aM){if(aM.hasOwnProperty(aP)&&P(aM[aP])){if(aO.length>0&&aO.lastIndexOf("&")<aO.length-1){aO+="&"}var aN=e!==undefined?(aO.indexOf(aP+"=")!=-1||e.indexOf(aP+"=")!=-1):aO.indexOf(aP+"=")!=-1;if(!aN){aO+=aP+"="+aM[aP]}}}}return aO}function O(aN,aP){if(aP!==undefined&&aP!=null){var aR="",e="";var aQ=aN.indexOf("?");var aM=aN.indexOf("#");if(aQ>-1){if(aM==-1){aM=aN.length-1}e=aN.substring(aQ,aM)}aR=E(aR,aP,e);var aO="";if(aM>-1&&aM!=aN.length-1){aO=aN.substring(aM);aN=aN.substring(0,aM)}if(aQ>-1){if(aQ+1<aN.length){aN+="&"}}else{aN+="?"}aN+=aR+aO}return aN}function aK(aP,aM){var aO=new XMLHttpRequest();if("withCredentials" in aO){try{aO.open(aP,aM,true)}catch(aN){consoleMessage(aN)}}else{if(typeof XDomainRequest!="undefined"){aO=new XDomainRequest();aO.open(aP,aM)}else{aO=null}}return aO}function aa(aM,aN,e){return function(){if(!P(aM)){return}if(aM.indexOf("//")==-1){aM="//"+aM}var aO=aK("GET",aM);if(!aO){j("CORS not supported");return}aO.onload=function(){var aP=aO.responseText;if(typeof aN=="function"){e.unshift(aP);aN.apply(null,e)}};aO.onerror=function(){};aO.onprogress=function(){};aO.ontimeout=function(){};aO.timeout=3000;aO.send()}}function aq(aM){var aN=document.createElement("div");aN.innerHTML=aM;var e=aN.childNodes;return e}function aB(aM){var aR=aM.length,aO,aP;for(var aN=0;aN<aR;aN++){try{aO=aM.shift();aP=aO.shift();aP[aL](q,aO)}catch(aQ){j("failed to run function "+aP+", error: "+aQ)}}}function W(aM){var aP=aM.length;while(aP>0){aP--;var aN=aM.shift();try{t.callMethod[aL](t,aN)}catch(aO){j("Error:: failed to run queue. Error message: "+aO)}}}var aJ=[],U=false;function ap(){U=true;if(document.addEventListener||event.type==="load"||document.readyState==="complete"){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",ap,false);window.removeEventListener("load",ap,false)}else{document.detachEvent("onreadystatechange",ap);window.detachEvent("onload",ap)}var aM=aJ.length;while(aM>0){aM--;var aN=aJ.shift();try{t.callMethod[aL](t,aN[0])}catch(aO){j("Error:: failed to run ready queue. Error message: "+aO)}}}}function c(){aJ.push(arguments);if(document.readyState==="complete"||U){U=true;j("DOM ready, running the method");t.callMethod[aL](t,arguments[0])}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",ap,false);window.addEventListener("load",ap,false)}else{document.attachEvent("onreadystatechange",ap);window.attachEvent("onload",ap)}}}var ay="font",ab="background",ao="text";var T={font:{family:"font-family",size:"font-size",color:"color"},background:{color:"background-color"}};var R={general:{allowedHigher:[ay]},title:{allowedHigher:[ao,ay,ab]},description:{allowedHigher:[ay]},cta:{allowedHigher:[ao,ay,ab]},content:{allowedHigher:[ab]}};var u={template1:{assetCount:3,containerSelector:"div[data-rtp-widget-container]",data:[{selector:"img.rtp_rcmd2_img",attribute:"src",property:l,handler:function(e){return decodeURIComponent(e)}},{selector:".rtp_rcmd2_link_hidden > h4",attribute:"innertext",property:B,handler:function(e){return decodeURIComponent(e)}},{selector:".rtp_rcmd2_description > p",attribute:"innertext",property:J,handler:function(e){return decodeURIComponent(e)}},{selector:".rtp_rcmd2_link",attribute:"href",property:h,handler:function(e,aM){return decodeURIComponent(e)}},{selector:".rtp_rcmd2_link_hidden",attribute:"href",property:h,handler:function(e,aM){return decodeURIComponent(e)}}],styleSelectors:{general:"div[data-rtp-widget-container]",title:".rtp_rcmd2_title",description:".rtp_rcmd2_description > p",cta:".rtp_rcmd2_link",content:".rtp_rcmd2_content_container"},defaultSettings:{"rcmd.title.text":"Content Recommendations","rcmd.cta.text":"Click Here"}},template2:{assetCount:3,containerSelector:"div[data-rtp-widget-container]",data:[{selector:"img.rtp_rcmd2_img",attribute:"src",property:l,handler:function(e){return decodeURIComponent(e)}},{selector:".rtp_rcmd2_label .rtp_rcmd2_link_hidden",attribute:"innertext",property:B,handler:function(e){return decodeURIComponent(e)}},{selector:".rtp_rcmd2_description",attribute:"innertext",property:J,handler:function(e){return decodeURIComponent(e)}},{selector:".rtp_rcmd2_link",attribute:"href",property:h,handler:function(e,aM){return decodeURIComponent(e)}},{selector:".rtp_rcmd2_link_hidden",attribute:"href",property:h,handler:function(e,aM){return decodeURIComponent(e)}}],styleSelectors:{general:"div[data-rtp-widget-container]",title:".rtp_rcmd2_title",description:".rtp_rcmd2_description",cta:".rtp_rcmd2_link",content:".rtp_rcmd2_content_container"},defaultSettings:{"rcmd.title.text":"Content Recommendations","rcmd.cta.text":"Click Here"}}},aC={};function m(aM,aW,aP,aT){if(ae(aP)&&D(aP)){var aN,aU,aO,aQ,aR,aV;for(var e in aP){aN=e.split(".");if(aN.length>2){aU=R[aN[1]];aQ=aT.styleSelectors[aN[1]];if(aU&&aU.allowedHigher.indexOf(aN[2])>-1){aO=aN[2];if(aO==ao){aR=L(aM,aQ);if(aR){for(var aS=0;aS<aR.length;aS++){aR[aS].innerHTML=aP[e]}}}else{aV=aQ+"{"+T[aN[2]][aN[3]]+":"+aP[e]+"!important }";if(aW.styleSheet){aW.styleSheet.cssText+=aV}else{aW.appendChild(document.createTextNode(aV))}}}}}}}function au(e,aP,aO,aM){var aN=aM.defaultSettings;if(ae(aN)&&D(aN)){m(e,aP,aN,aM)}m(e,aP,aO,aM)}function Z(aO,aM){if(!P(aO)){throw"can't change settings for null or empty widgetId"}if(!D(aM)){throw"settings can't be null or not an object"}var aN=u[aO];if(aN){if(!aN[V]){aN[V]={}}for(var e in aM){if(N(aM,e)&&ae(aM[e])){aN[V][e]=aM[e]}}u[aO]}}function ax(aM,aR,aQ){var aP,e;for(var aO=0;aO<aR.length;aO++){e=aQ[aR[aO].property];if(!ae(e)){throw"cannot set undefined value for recommendation"}if(aR[aO].handler&&typeof aR[aO].handler=="function"){e=aR[aO].handler(e,aQ)}aP=L(aM,aR[aO].selector);if(ae(aP)&&aP.length>0){if(aR[aO].attribute=="innertext"){aP[0].innerHTML=e.replace(/(?:\r\n|\r|\n)/g,"<br/>")}else{for(var aN=0;aN<aP.length;aN++){aP[aN].setAttribute(aR[aO].attribute,e)}}}else{throw"no nodes found for: "+aR[aO].selector}}}function w(e){for(var aM=0;aM<e.length;aM++){if(e[aM].getAttribute&&e[aM].getAttribute(aj)){return e[aM]}}return null}function z(e){for(var aM=0;aM<e.length;aM++){if(e[aM].tagName.toLowerCase()=="style"){return e[aM]}}return null}function o(aN,e){for(var aM=0;aM<e.length;aM++){aN.appendChild(e[aM])}}function ah(){aB(I)}function ad(aP,aS,aV){var aO=JSON.parse(aP);if(!ae(aO.rcmd)||!ae(aO.rcmd.assets)){throw"No assets to recommend"}if(aA.indexOf(aV)>-1){j("the "+aV+" already injected");return}var aU;var aX=u[aS];var aR=aX[aw];var aT=aX[av];if(!P(aT)){I.push([ad,aP,aS,aV]);return}var aW=aO.rcmd.assets;var aM=aq(aT);var e=w(aM);var aY=z(aM);if(e==null){throw"can't find main container in HTML"}var aN=L(e,aX[aI]);if(aN.length!=aW.length){throw"number of recommnedations doesn't match number of widget containers"}au(e,aY,aX[V],aX);for(var aQ=0;aQ<aN.length;aQ++){aU=aW[aQ];ax(aN[aQ],aR,aU)}o(document.getElementById(aV),aM);aA.push(aV)}function y(aN,e,aP){var aO=null;if(x){aO=x.rch}var aM="";if(ag!=null){aM=ag}return O(G+at,{session_id:al,visitor_id:A,account_id:k,template_id:aP,visit_count:an,view_count:p,categories:e!=void 0?e.join(","):void 0,consumed:aO,mkto_tok:aM})}function a(){var aO,aR=0,aN,aQ;for(var e in aC){if(N(aC,e)&&aA.indexOf(e)==-1){aQ=aC[e];aO=u[aQ];var aP=aO[V];var aM=void 0;if(ae(aP)){if(ae(aP.category)&&!C(aP.category)){aM=aP.category}}aR=aO.assetCount;aN=y(aR,aM,aQ);aa(aN,ad,[aQ,e])()}else{j("can't get data for container "+e+", the container alreay has data")}}}function aF(){var aN=F("div[data-rtp-template-id]");if(aN.length==0){j("cannot find any widgets on the page");return}var aP,e,aO;for(var aM=0;aM<aN.length;aM++){aP=aN[aM];e="rtp-widget-container-"+af();aP.setAttribute("id",e);aO=aP.getAttribute("data-rtp-template-id");aC[e]=aO}}function v(e,aN){var aM=u[aN];if(aM){aM[av]=e;u[aN]=aM;ah()}else{j("cannot find widget for widget id: "+aN)}}function aE(e){return S+"/"+e+".html?"+af()}function K(aO){if(C(aO)){throw"can't fetch templates for empty array"}var aM;var e=[];for(var aN=0;aN<aO.length;aN++){if(e.indexOf(aO[aN])==-1){e.push(aO[aN]);aM=aE(aO[aN]);aa(aM,v,[aO[aN]])()}}}var ak=function(){return t.callMethod[aL](t,[arguments])};ak.getSettings=function(e){return u[e]&&u[e][V]};var t={};t.callMethod=function(){if(!U){c(arguments);return}var aN,aP=null;for(var aM=0;aM<arguments[aH];aM++){try{aN=arguments[aM];aP=aN[0];this.applyMethod(q,aP,aN)}catch(aO){j("failed to run "+aP+". Error: "+aO)}}};t.applyMethod=function(aM,aN,e){e=[][n][r](e,1);return aM[aN][aL](aM,e)};var q={};q[az]=function(){j("changing widget settings");var e=arguments[0];if(D(e)){for(var aM in e){Z(aM,e[aM])}}else{Z(e,arguments[1])}};q[ac]=function(){j("initiating RCMD widget");var e=arguments[0];if(!D(e)){throw"expected configurations object for recommendation widget"}G=e.serverUrl;if(!P(G)){throw"server URL can't be null or empty"}if(G.indexOf("//")==-1){G="//"+G}al=e.sid;if(!P(al)){throw"session id can't be null or empty"}A=e.vid;if(!P(A)){throw"visitor id can't be null or empty"}an=e.vc;if(isNaN(an)||an<1){throw"visit must be a number and bigger than 0"}p=e.cc;if(isNaN(p)||p<1){throw"click count must be a number and bigger than 0"}x=e.consumedAssets;if(P(e.munchkinToken)){ag=e.munchkinToken}aF();var aN=[];for(var aM in aC){if(N(aC,aM)){aN.push(aC[aM])}}K(aN);ai=true;W(f)};q[aD]=function(){if(!ai){j("can't get RCMD, script isn't initialized, waiting...");f.push([["get"]]);return}j("getting RCMD content");a()};k=X[ar]&&X[ar].getTracker().trackerData.aid;if(k===undefined||k==null){throw"cannot get recommendations without rtp account id"}var i=X.rtpRCMD.q;X.rtpRCMD=ak;i&&t.callMethod[aL](t,i)})();
